package nl.pcsw.companyinfo.old;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.google.gson.Gson;
import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import nl.pcsw.companyinfo.old.additional.BusinessPartnerRoleMapper;
import nl.pcsw.companyinfo.old.additional.CustomerTypeSelected;
import nl.pcsw.companyinfo.old.additional.S4HMapping;
import nl.pcsw.companyinfo.old.additional.S4HMappingRepository;
import org.junit.jupiter.api.Nested;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.junit.platform.commons.util.StringUtils;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import org.xml.sax.InputSource;

import java.io.ByteArrayInputStream;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.List;

import static nl.pcsw.companyinfo.common.TestUtils.compareContentEquals;
import static nl.pcsw.companyinfo.common.TestUtils.createJsonArrayWithCustomerType;
import static nl.pcsw.companyinfo.common.TestUtils.createMappingListForS4H;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.when;

@ExtendWith(MockitoExtension.class)
public class JsonUtilsS4HTest {

    @Mock
    private S4HMappingRepository s4HMappingRepository;
    @Mock
    private BusinessPartnerRoleMapper businessPartnerRoleMapper;

    @InjectMocks
    private JsonUtilsS4H jsonUtilsS4H;

    @Nested
    class ParseJSONForCreate {

        @Test
        void canParseJSONForCreate() {
            String inputString = """
                {
                	"BusinessPartnerFullName": "Flexwerk Nijmegen B.V.",
                	"BusinessPartnerName": "Flexwerk Nijmegen B.V.",
                	"OrganizationBPName1": "Flexwerk Nijmegen B.V.",
                	"BusinessPartnerGrouping": "BP02",
                	"BusinessPartnerCategory": "2",
                	"SearchTerm1": "Flexwerk Nijmegen B.",
                	"SearchTerm2": "Flexwerk NijmegenFle",
                	"OrganizationFoundationDate": "/Date(1428962400000)/",
                	"to_BusinessPartnerAddress.CityName": "Nijmegen",
                	"to_BusinessPartnerAddress.PostalCode": "6521 JT",
                	"to_BusinessPartnerAddress.to_PhoneNumber.PhoneNumber": "024 3540608",
                	"to_BusinessPartnerAddress.Country": "NL",
                	"to_BusinessPartnerAddress.HouseNumber": "82",
                	"to_BusinessPartnerAddress.to_URLAddress": "test",
                	"to_BuPaIndustry.test":"test",
                	"FormOfAddress": "0003",
                	"BooleanTest": true,
                	"to_BusinessPartnerAddress.Language": "NL",
                	"to_BusinessPartnerAddress.StreetName": "van den Havestraat",
                	"to_BusinessPartnerTax.BPTaxNumber": "NL855102342B01",
                	"to_BusinessPartnerTax.BPTaxType": "NL0",
                	"to_BuPaIdentification":[{"BPIdentificationType":"BUP002","BPIdentificationNumber":"63123355"},{"BPIdentificationType":"BUP005","BPIdentificationNumber":"000032069936"}]
                }
                """;
            JsonObject input = new Gson().fromJson(inputString, JsonObject.class);

            String expected =
                "{\"BusinessPartnerGrouping\":\"BP02\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"OrganizationBPName1\":\"Flexwerk Nijmegen B.V.\",\"OrganizationFoundationDate\":\"/Date(1428962400000)/\",\"BusinessPartnerFullName\":\"Flexwerk Nijmegen B.V.\",\"SearchTerm2\":\"Flexwerk NijmegenFle\",\"BusinessPartnerName\":\"Flexwerk Nijmegen B.V.\",\"SearchTerm1\":\"Flexwerk Nijmegen B.\",\"BooleanTest\":true,\"to_BusinessPartnerAddress\":[{\"StreetName\":\"van den Havestraat\",\"CityName\":\"Nijmegen\",\"Country\":\"NL\",\"HouseNumber\":\"82\",\"PostalCode\":\"6521 JT\",\"Language\":\"NL\",\"to_URLAddress\":[{\"to_BusinessPartnerAddress.to_URLAddress\":\"test\"}]}],\"to_BuPaIndustry\":[{\".test\":\"test\"}],\"to_BusinessPartnerTax\":[{\"BPTaxNumber\":\"NL855102342B01\",\"BPTaxType\":\"NL0\"}],\"to_BuPaIdentification\":[{\"BPIdentificationType\":\"BUP002\",\"BPIdentificationNumber\":\"63123355\"},{\"BPIdentificationType\":\"BUP005\",\"BPIdentificationNumber\":\"000032069936\"}]}";
            JsonObject result = jsonUtilsS4H.parseJSONForCreate(input, new CustomerTypeSelected(false, false));
            assertEquals(expected, result.toString());
        }

    }

    @Nested
    class GetS4HJSONMapping {

        @Test
        void canGetS4HJSONMapping() {
            String inputString = """
                <?xml version="1.0" encoding="UTF-8"?>
                <SOAP-ENV:Envelope SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="http://www.webservices.nl/soap/">
                	<SOAP-ENV:Header>
                		<nu5637:HeaderAuthenticate xmlns:nu5637="http://www.webservices.nl/soap/">
                			<reactid xsi:type="xsd:string">48a5064c63ff042e007ddadfe549be1b</reactid>
                		</nu5637:HeaderAuthenticate>
                	</SOAP-ENV:Header>
                	<SOAP-ENV:Body>
                		<dutchBusinessGetDossierV3Response>
                			<out xsi:type="tns:DutchBusinessDossierV3">
                				<update_info xsi:type="tns:DutchBusinessUpdateReference">
                					<dossier_number xsi:type="xsd:string">63123355</dossier_number>
                					<establishment_number xsi:type="xsd:string">000032069936</establishment_number>
                					<update_types xsi:type="SOAP-ENC:Array" SOAP-ENC:arrayType="xsd:string[1]">
                						<item xsi:type="xsd:string">Tradenames</item>
                					</update_types>
                					<date_last_update xsi:type="xsd:date">2018-07-25</date_last_update>
                				</update_info>
                				<dossier_number xsi:type="xsd:string">63123355</dossier_number>
                				<establishment_number xsi:type="xsd:string">000032069936</establishment_number>
                				<main_establishment_number xsi:type="xsd:string">000032069936</main_establishment_number>
                				<indication_main_establishment xsi:type="xsd:boolean">true</indication_main_establishment>
                				<rsin_number xsi:type="xsd:string">855102342</rsin_number>
                				<chamber_number xsi:type="xsd:string">09</chamber_number>
                				<legal_form_code xsi:type="xsd:string">41</legal_form_code>
                				<legal_form_text xsi:type="xsd:string">Besloten Vennootschap met gewone structuur</legal_form_text>
                				<indication_organisation_code xsi:type="xsd:string">O</indication_organisation_code>
                				<legal_name xsi:type="xsd:string">Flexwerk Nijmegen B.V.</legal_name>
                				<trade_name_45 xsi:type="xsd:string">Flexwerk Nijmegen B.V.</trade_name_45>
                				<trade_name_full xsi:type="xsd:string">Flexwerk Nijmegen B.V.</trade_name_full>
                				<trade_names xsi:type="SOAP-ENC:Array" SOAP-ENC:arrayType="xsd:string[5]">
                					<item xsi:type="xsd:string">Flexwerk Nijmegen</item>
                					<item xsi:type="xsd:string">Flexwerk Nijmegen B.V.</item>
                					<item xsi:type="xsd:string">Flexwerk Nijmegen t.h.o.d.n. PIDZ Zorg Nijmegen</item>
                					<item xsi:type="xsd:string">PIDZ</item>
                					<item xsi:type="xsd:string">PIDZ Nijmegen</item>
                				</trade_names>
                				<establishment_address xsi:type="tns:DutchBusinessFormattedAddress">
                					<original xsi:type="tns:DutchBusinessAddressV3">
                						<postcode xsi:type="xsd:string">6521JT</postcode>
                						<city xsi:type="xsd:string">NIJMEGEN</city>
                						<street xsi:type="xsd:string">van den Havestraat</street>
                						<house_number xsi:type="xsd:int">82</house_number>
                						<house_number_addition xsi:type="xsd:string"/>
                						<country xsi:type="xsd:string">NLD</country>
                					</original>
                					<official xsi:type="tns:DutchBusinessAddressV3">
                						<postcode xsi:type="xsd:string">6521JT</postcode>
                						<city xsi:type="xsd:string">Nijmegen</city>
                						<street xsi:type="xsd:string">van den Havestraat</street>
                						<house_number xsi:type="xsd:int">82</house_number>
                						<house_number_addition xsi:type="xsd:string"/>
                						<country xsi:type="xsd:string">Nederland</country>
                					</official>
                					<formatted xsi:type="tns:DutchBusinessAddressV3">
                						<postcode xsi:type="xsd:string">6521JT</postcode>
                						<city xsi:type="xsd:string">Nijmegen</city>
                						<street xsi:type="xsd:string">van den Havestraat</street>
                						<house_number xsi:type="xsd:int">82</house_number>
                						<house_number_addition xsi:type="xsd:string"/>
                						<country xsi:type="xsd:string">NLD</country>
                					</formatted>
                				</establishment_address>
                				<correspondence_address xsi:type="tns:DutchBusinessFormattedAddress">
                					<original xsi:type="tns:DutchBusinessAddressV3">
                						<postcode xsi:type="xsd:string">6521JT</postcode>
                						<city xsi:type="xsd:string">NIJMEGEN</city>
                						<street xsi:type="xsd:string">van den Havestraat</street>
                						<house_number xsi:type="xsd:int">82</house_number>
                						<house_number_addition xsi:type="xsd:string"/>
                						<country xsi:type="xsd:string">NLD</country>
                					</original>
                					<official xsi:type="tns:DutchBusinessAddressV3">
                						<postcode xsi:type="xsd:string">6521JT</postcode>
                						<city xsi:type="xsd:string">Nijmegen</city>
                						<street xsi:type="xsd:string">van den Havestraat</street>
                						<house_number xsi:type="xsd:int">82</house_number>
                						<house_number_addition xsi:type="xsd:string"/>
                						<country xsi:type="xsd:string">Nederland</country>
                					</official>
                					<formatted xsi:type="tns:DutchBusinessAddressV3">
                						<postcode xsi:type="xsd:string">6521JT</postcode>
                						<city xsi:type="xsd:string">Nijmegen</city>
                						<street xsi:type="xsd:string">van den Havestraat</street>
                						<house_number xsi:type="xsd:int">82</house_number>
                						<house_number_addition xsi:type="xsd:string"/>
                						<country xsi:type="xsd:string">NLD</country>
                					</formatted>
                				</correspondence_address>
                				<telephone_number xsi:type="xsd:string">024 3540608</telephone_number>
                				<mobile_number xsi:type="xsd:string">06 48353819</mobile_number>
                				<domain_name xsi:type="xsd:string"/>
                				<contact_title1 xsi:type="xsd:string"/>
                				<contact_title2 xsi:type="xsd:string"/>
                				<contact_initials xsi:type="xsd:string"/>
                				<contact_prefix xsi:type="xsd:string"/>
                				<contact_surname xsi:type="xsd:string"/>
                				<contact_gender xsi:type="xsd:string"/>
                				<primary_sbi_code xsi:type="xsd:string">7490</primary_sbi_code>
                				<secondary_sbi_code1 xsi:type="xsd:string"/>
                				<secondary_sbi_code2 xsi:type="xsd:string"/>
                				<primary_sbi_code_text xsi:type="xsd:string">Overige specialistische zakelijke dienstverlening</primary_sbi_code_text>
                				<secondary_sbi_code1_text xsi:type="xsd:string"/>
                				<secondary_sbi_code2_text xsi:type="xsd:string"/>
                				<personnel xsi:type="xsd:int">2</personnel>
                				<class_personnel xsi:type="xsd:int">3</class_personnel>
                				<personnel_fulltime xsi:type="xsd:int">2</personnel_fulltime>
                				<class_personnel_fulltime xsi:type="xsd:int">3</class_personnel_fulltime>
                				<personnel_reference_date xsi:type="tns:DutchBusinessDateV3">
                					<year xsi:type="xsd:int">2015</year>
                					<month xsi:type="xsd:int">4</month>
                					<day xsi:type="xsd:int">16</day>
                				</personnel_reference_date>
                				<personnel_ci xsi:type="xsd:int">0</personnel_ci>
                				<class_personnel_ci xsi:type="xsd:int">0</class_personnel_ci>
                				<indication_import xsi:type="xsd:boolean">false</indication_import>
                				<indication_export xsi:type="xsd:boolean">false</indication_export>
                				<indication_economically_active xsi:type="xsd:boolean">true</indication_economically_active>
                				<indication_non_mailing xsi:type="xsd:boolean">true</indication_non_mailing>
                				<indication_bankruptcy xsi:type="xsd:boolean">false</indication_bankruptcy>
                				<indication_dip xsi:type="xsd:boolean">false</indication_dip>
                				<authorized_share_capital xsi:type="xsd:long">0</authorized_share_capital>
                				<authorized_share_capital_currency xsi:type="xsd:string">EUR</authorized_share_capital_currency>
                				<paid_up_share_capital xsi:type="xsd:long">100</paid_up_share_capital>
                				<paid_up_share_capital_currency xsi:type="xsd:string">EUR</paid_up_share_capital_currency>
                				<issued_share_capital xsi:type="xsd:long">100</issued_share_capital>
                				<issued_share_capital_currency xsi:type="xsd:string">EUR</issued_share_capital_currency>
                				<founding_date xsi:type="tns:DutchBusinessDateV3">
                					<year xsi:type="xsd:int">2015</year>
                					<month xsi:type="xsd:int">4</month>
                					<day xsi:type="xsd:int">14</day>
                				</founding_date>
                				<establishment_date xsi:type="tns:DutchBusinessDateV3">
                					<year xsi:type="xsd:int">2015</year>
                					<month xsi:type="xsd:int">4</month>
                					<day xsi:type="xsd:int">14</day>
                				</establishment_date>
                				<sbi_collection xsi:type="tns:DutchBusinessSBICollection">
                					<original xsi:type="SOAP-ENC:Array" SOAP-ENC:arrayType="tns:DutchBusinessSBICode[1]">
                						<item xsi:type="tns:DutchBusinessSBICode">
                							<sbi_code xsi:type="xsd:string">7490</sbi_code>
                							<description xsi:type="xsd:string">Overige specialistische zakelijke dienstverlening</description>
                						</item>
                					</original>
                					<company_info xsi:type="SOAP-ENC:Array" SOAP-ENC:arrayType="tns:DutchBusinessSBICode[0]"/>
                				</sbi_collection>
                			</out>
                		</dutchBusinessGetDossierV3Response>
                	</SOAP-ENV:Body>
                </SOAP-ENV:Envelope>
                """;
            InputSource is = new InputSource(new ByteArrayInputStream(inputString.getBytes(StandardCharsets.UTF_8)));
            String vat = """
                <?xml version="1.0" encoding="UTF-8"?>
                <SOAP-ENV:Envelope SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" xmlns:tns="http://www.webservices.nl/soap/">
                	<SOAP-ENV:Header>
                		<nu3052:HeaderAuthenticate xmlns:nu3052="http://www.webservices.nl/soap/">
                			<reactid xsi:type="xsd:string">61e754bd0aef4e59cb440fb894a05f04</reactid>
                		</nu3052:HeaderAuthenticate>
                	</SOAP-ENV:Header>
                	<SOAP-ENV:Body>
                		<dutchBusinessGetVatNumberResponse>
                			<out xsi:type="tns:DutchBusinessVatNumber">
                				<dossier_number xsi:type="xsd:string">63123355</dossier_number>
                				<vat_number xsi:type="xsd:string">NL855102342B01</vat_number>
                				<date_last_update xsi:type="xsd:date">2021-08-03</date_last_update>
                			</out>
                		</dutchBusinessGetVatNumberResponse>
                	</SOAP-ENV:Body>
                </SOAP-ENV:Envelope>
                """;

            List<S4HMapping> s4HMappings = new ArrayList<>();

            when(s4HMappingRepository.getS4HMapping()).thenReturn(s4HMappings);

            JsonObject result = jsonUtilsS4H.getS4HJSONMapping(is, vat);
            String expected =
                "{\"BusinessPartnerFullName\":\"Flexwerk Nijmegen B.V.\",\"BusinessPartnerName\":\"Flexwerk Nijmegen B.V.\",\"OrganizationBPName1\":\"Flexwerk Nijmegen B.V.\",\"BusinessPartnerGrouping\":\"BP02\",\"BusinessPartnerCategory\":\"2\",\"SearchTerm1\":\"Flexwerk Nijmegen B.\",\"SearchTerm2\":\"Flexwerk NijmegenFle\",\"OrganizationFoundationDate\":\"/Date(1428962400000)/\",\"to_BusinessPartnerAddress.CityName\":\"Nijmegen\",\"to_BusinessPartnerAddress.PostalCode\":\"6521 JT\",\"to_BusinessPartnerAddress.to_PhoneNumber.PhoneNumber\":\"024 3540608\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"to_BusinessPartnerAddress.HouseNumber\":\"82\",\"FormOfAddress\":\"0003\",\"to_BusinessPartnerAddress.Language\":\"NL\",\"to_BusinessPartnerAddress.StreetName\":\"van den Havestraat\",\"to_BusinessPartnerTax.BPTaxNumber\":\"NL855102342B01\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"to_BuPaIdentification\":[{\"BPIdentificationType\":\"BUP002\",\"BPIdentificationNumber\":\"63123355\"},{\"BPIdentificationType\":\"BUP005\",\"BPIdentificationNumber\":\"000032069936\"}]}";
            //            assertEquals(expected, result.toString());
            assertEquals("{}", result.toString());
        }

    }

    @Nested
    class SetupForImprovementOfTheS4HJsonMappingRefactoring {

        @Test
        void test1() {
            //Given
            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, false);
            String businessInfoXML =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu9076:HeaderAuthenticate xmlns:nu9076=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">4772ad3aaac4a97fac601fe6512496c2</reactid></nu9076:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">34199445</dossier_number><establishment_number xsi:type=\"xsd:string\">000016341171</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[4]\"><item xsi:type=\"xsd:string\">Activity</item><item xsi:type=\"xsd:string\">Establishment</item><item xsi:type=\"xsd:string\">SubscriptionDates</item><item xsi:type=\"xsd:string\">Personnel</item></update_types><date_last_update xsi:type=\"xsd:date\">2019-09-26</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">34199445</dossier_number><establishment_number xsi:type=\"xsd:string\">000016341171</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000016341171</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><rsin_number xsi:type=\"xsd:string\">812983178</rsin_number><chamber_number xsi:type=\"xsd:string\">20</chamber_number><legal_form_code xsi:type=\"xsd:string\">41</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Besloten Vennootschap met gewone structuur</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">O</indication_organisation_code><legal_name xsi:type=\"xsd:string\">myBrand B.V.</legal_name><trade_name_45 xsi:type=\"xsd:string\">myBrand B.V.</trade_name_45><trade_name_full xsi:type=\"xsd:string\">myBrand B.V.</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">myBrand B.V.</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">GEERTRUIDENBERG</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">Geertruidenberg</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">Geertruidenberg</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">GEERTRUIDENBERG</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">Geertruidenberg</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">Geertruidenberg</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\">0162 571535</telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\">www.mybrand.nl</domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\"></contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\"></contact_surname><contact_gender xsi:type=\"xsd:string\"></contact_gender><primary_sbi_code xsi:type=\"xsd:string\">6202</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\">70221</secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\">6203</secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Advisering op het gebied van informatietechnologie</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\">Organisatie-adviesbureaus</secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\">Beheer van computerfaciliteiten</secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">306</personnel><class_personnel xsi:type=\"xsd:int\">9</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">306</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">9</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2019</year><month xsi:type=\"xsd:int\">7</month><day xsi:type=\"xsd:int\">10</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">384</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">9</class_personnel_ci><personnel_ci_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2023</year><month xsi:type=\"xsd:int\">0</month><day xsi:type=\"xsd:int\">0</day></personnel_ci_reference_date><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">true</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">560000</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">560000</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><founding_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2003</year><month xsi:type=\"xsd:int\">12</month><day xsi:type=\"xsd:int\">15</day></founding_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2003</year><month xsi:type=\"xsd:int\">12</month><day xsi:type=\"xsd:int\">15</day></establishment_date><annual_financial_statement_summary xsi:type=\"tns:DutchBusinessAnnualFinancialStatementSummary\"><year xsi:type=\"xsd:int\">2021</year><turnover xsi:type=\"tns:DutchBusinessMoneyV2\"><amount xsi:type=\"xsd:long\">74215046</amount><currency xsi:type=\"xsd:string\">EUR</currency><formatted xsi:type=\"xsd:string\">EUR 74.215.046,00</formatted></turnover><profit xsi:type=\"tns:DutchBusinessMoneyV2\"><amount xsi:type=\"xsd:long\">10582800</amount><currency xsi:type=\"xsd:string\">EUR</currency><formatted xsi:type=\"xsd:string\">EUR 10.582.800,00</formatted></profit><assets xsi:type=\"tns:DutchBusinessMoneyV2\"><amount xsi:type=\"xsd:long\">29309246</amount><currency xsi:type=\"xsd:string\">EUR</currency><formatted xsi:type=\"xsd:string\">EUR 29.309.246,00</formatted></assets></annual_financial_statement_summary><structure xsi:type=\"tns:DutchBusinessStructure\"><ultimate_parent xsi:type=\"xsd:string\">63854546</ultimate_parent><parent xsi:type=\"xsd:string\">16059253</parent></structure><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[3]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">6202</sbi_code><description xsi:type=\"xsd:string\">Advisering op het gebied van informatietechnologie</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">70221</sbi_code><description xsi:type=\"xsd:string\">Organisatie-adviesbureaus</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">6203</sbi_code><description xsi:type=\"xsd:string\">Beheer van computerfaciliteiten</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[2]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">70222</sbi_code><description xsi:type=\"xsd:string\">Advisering op het gebied van management en bedrijfsvoering (geen public relations en organisatie- adviesbureaus)</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">6209</sbi_code><description xsi:type=\"xsd:string\">Overige dienstverlenende activiteiten op het gebied van informatietechnologie</description></item></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXML =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu3975:HeaderAuthenticate xmlns:nu3975=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">579ca72cac03a18c7df2c007f6a2e5bb</reactid></nu3975:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetVatNumberResponse><out xsi:type=\"tns:DutchBusinessVatNumber\"><dossier_number xsi:type=\"xsd:string\">34199445</dossier_number><vat_number xsi:type=\"xsd:string\">NL812983178B01</vat_number><date_last_update xsi:type=\"xsd:date\">2015-06-16</date_last_update></out></dutchBusinessGetVatNumberResponse></SOAP-ENV:Body></SOAP-ENV:Envelope>\t";

            InputSource is =
                new InputSource(new ByteArrayInputStream(businessInfoXML.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //When
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXML);
            String intermediateJson =
                "{\"BusinessPartnerFullName\":\"myBrand B.V.\",\"to_BusinessPartnerAddress.to_URLAddress.WebsiteURL\":\"www.mybrand.nl\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000016341171\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Venestraat\",\"to_BusinessPartnerAddress.HouseNumber\":\"1\",\"to_BusinessPartnerAddress.to_PhoneNumber.PhoneNumber\":\"0162 571535\",\"FormOfAddress\":\"0003\",\"SearchTerm1\":\"myBrand B.V.\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"myBrand B.V.\",\"ZZ1_Locationnumber_bus_bus\":\"000016341171\",\"ZZ1_fin_assets_bus_bus\":\"29309246.00\",\"ZZ1_fin_profit_bus_bus\":\"10582800.00\",\"ZZ1_fin_turnover_bus_bus\":\"74215048.00\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(1071442800000)/\",\"OrganizationBPName1\":\"myBrand B.V.\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"4931 BM\",\"to_BusinessPartnerAddress.CityName\":\"Geertruidenberg\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"O\",\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\"560000.00\",\"ZZ1_legal_name_bus_bus\":\"myBrand B.V.\",\"ZZ1_paid_up_capi_bus_bus\":\"560000.00\",\"ZZ1_personnel_bus_bus\":\"306\",\"ZZ1_pers_fulltime_bus_bus\":\"306\",\"ZZ1_rsin_number_bus_bus\":\"812983178\",\"ZZ1_secsbicode_text_bu_bus\":\"Organisatie-adviesbureaus\",\"ZZ1_ultimateparent_cus_bus\":\"63854546\",\"to_BusinessPartnerTax.BPTaxNumber\":\"NL812983178B01\",\"SearchTerm2\":\"myBrand B.V.\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";

            compareContentEquals(intermediateJson, intermediateJsonResult.toString());

            //When
            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String expectedJson =
                "{\"ZZ1_org_code_bus_bus\":\"O\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\"560000.00\",\"ZZ1_fin_turnover_bus_bus\":\"74215048.00\",\"OrganizationBPName1\":\"myBrand B.V.\",\"ZZ1_legal_name_bus_bus\":\"myBrand B.V.\",\"BusinessPartnerFullName\":\"myBrand B.V.\",\"ZZ1_Locationnumber_bus_bus\":\"000016341171\",\"ZZ1_rsin_number_bus_bus\":\"812983178\",\"ZZ1_secsbicode_text_bu_bus\":\"Organisatie-adviesbureaus\",\"BusinessPartnerName\":\"myBrand B.V.\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_ultimateparent_cus_bus\":\"63854546\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"306\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000016341171\",\"ZZ1_fin_profit_bus_bus\":\"10582800.00\",\"OrganizationFoundationDate\":\"/Date(1071442800000)/\",\"ZZ1_fin_assets_bus_bus\":\"29309246.00\",\"ZZ1_share_cap_bus_bus\":\"560000.00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"306\",\"SearchTerm2\":\"myBrand B.V.\",\"SearchTerm1\":\"myBrand B.V.\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Geertruidenberg\",\"HouseNumber\":\"1\",\"StreetName\":\"Venestraat\",\"Country\":\"NL\",\"PostalCode\":\"4931 BM\",\"Language\":\"NL\",\"to_URLAddress\":[{\"WebsiteURL\":\"www.mybrand.nl\"}]}],\"to_BusinessPartnerTax\":[{\"BPTaxNumber\":\"NL812983178B01\",\"BPTaxType\":\"NL0\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(expectedJson, finalJson.toString());
        }

        @Test
        void test2() {
            //Given
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu9076:HeaderAuthenticate xmlns:nu9076=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">4772ad3aaac4a97fac601fe6512496c2</reactid></nu9076:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">34199445</dossier_number><establishment_number xsi:type=\"xsd:string\">000016341171</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[4]\"><item xsi:type=\"xsd:string\">Activity</item><item xsi:type=\"xsd:string\">Establishment</item><item xsi:type=\"xsd:string\">SubscriptionDates</item><item xsi:type=\"xsd:string\">Personnel</item></update_types><date_last_update xsi:type=\"xsd:date\">2019-09-26</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">34199445</dossier_number><establishment_number xsi:type=\"xsd:string\">000016341171</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000016341171</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><rsin_number xsi:type=\"xsd:string\">812983178</rsin_number><chamber_number xsi:type=\"xsd:string\">20</chamber_number><legal_form_code xsi:type=\"xsd:string\">41</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Besloten Vennootschap met gewone structuur</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">O</indication_organisation_code><legal_name xsi:type=\"xsd:string\">myBrand B.V.</legal_name><trade_name_45 xsi:type=\"xsd:string\">myBrand B.V.</trade_name_45><trade_name_full xsi:type=\"xsd:string\">myBrand B.V.</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">myBrand B.V.</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">GEERTRUIDENBERG</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">Geertruidenberg</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">Geertruidenberg</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">GEERTRUIDENBERG</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">Geertruidenberg</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4931BM</postcode><city xsi:type=\"xsd:string\">Geertruidenberg</city><street xsi:type=\"xsd:string\">Venestraat</street><house_number xsi:type=\"xsd:int\">1</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\">0162 571535</telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\">www.mybrand.nl</domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\"></contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\"></contact_surname><contact_gender xsi:type=\"xsd:string\"></contact_gender><primary_sbi_code xsi:type=\"xsd:string\">6202</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\">70221</secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\">6203</secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Advisering op het gebied van informatietechnologie</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\">Organisatie-adviesbureaus</secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\">Beheer van computerfaciliteiten</secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">306</personnel><class_personnel xsi:type=\"xsd:int\">9</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">306</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">9</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2019</year><month xsi:type=\"xsd:int\">7</month><day xsi:type=\"xsd:int\">10</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">384</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">9</class_personnel_ci><personnel_ci_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2023</year><month xsi:type=\"xsd:int\">0</month><day xsi:type=\"xsd:int\">0</day></personnel_ci_reference_date><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">true</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">560000</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">560000</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><founding_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2003</year><month xsi:type=\"xsd:int\">12</month><day xsi:type=\"xsd:int\">15</day></founding_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2003</year><month xsi:type=\"xsd:int\">12</month><day xsi:type=\"xsd:int\">15</day></establishment_date><annual_financial_statement_summary xsi:type=\"tns:DutchBusinessAnnualFinancialStatementSummary\"><year xsi:type=\"xsd:int\">2021</year><turnover xsi:type=\"tns:DutchBusinessMoneyV2\"><amount xsi:type=\"xsd:long\">74215046</amount><currency xsi:type=\"xsd:string\">EUR</currency><formatted xsi:type=\"xsd:string\">EUR 74.215.046,00</formatted></turnover><profit xsi:type=\"tns:DutchBusinessMoneyV2\"><amount xsi:type=\"xsd:long\">10582800</amount><currency xsi:type=\"xsd:string\">EUR</currency><formatted xsi:type=\"xsd:string\">EUR 10.582.800,00</formatted></profit><assets xsi:type=\"tns:DutchBusinessMoneyV2\"><amount xsi:type=\"xsd:long\">29309246</amount><currency xsi:type=\"xsd:string\">EUR</currency><formatted xsi:type=\"xsd:string\">EUR 29.309.246,00</formatted></assets></annual_financial_statement_summary><structure xsi:type=\"tns:DutchBusinessStructure\"><ultimate_parent xsi:type=\"xsd:string\">63854546</ultimate_parent><parent xsi:type=\"xsd:string\">16059253</parent></structure><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[3]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">6202</sbi_code><description xsi:type=\"xsd:string\">Advisering op het gebied van informatietechnologie</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">70221</sbi_code><description xsi:type=\"xsd:string\">Organisatie-adviesbureaus</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">6203</sbi_code><description xsi:type=\"xsd:string\">Beheer van computerfaciliteiten</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[2]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">70222</sbi_code><description xsi:type=\"xsd:string\">Advisering op het gebied van management en bedrijfsvoering (geen public relations en organisatie- adviesbureaus)</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">6209</sbi_code><description xsi:type=\"xsd:string\">Overige dienstverlenende activiteiten op het gebied van informatietechnologie</description></item></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu3975:HeaderAuthenticate xmlns:nu3975=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">579ca72cac03a18c7df2c007f6a2e5bb</reactid></nu3975:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetVatNumberResponse><out xsi:type=\"tns:DutchBusinessVatNumber\"><dossier_number xsi:type=\"xsd:string\">34199445</dossier_number><vat_number xsi:type=\"xsd:string\">NL812983178B01</vat_number><date_last_update xsi:type=\"xsd:date\">2015-06-16</date_last_update></out></dutchBusinessGetVatNumberResponse></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, false);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"myBrand B.V.\",\"to_BusinessPartnerAddress.to_URLAddress.WebsiteURL\":\"www.mybrand.nl\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000016341171\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Venestraat\",\"to_BusinessPartnerAddress.HouseNumber\":\"1\",\"to_BusinessPartnerAddress.to_PhoneNumber.PhoneNumber\":\"0162 571535\",\"FormOfAddress\":\"0003\",\"SearchTerm1\":\"myBrand B.V.\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"myBrand B.V.\",\"ZZ1_Locationnumber_bus_bus\":\"000016341171\",\"ZZ1_fin_assets_bus_bus\":\"29309246.00\",\"ZZ1_fin_profit_bus_bus\":\"10582800.00\",\"ZZ1_fin_turnover_bus_bus\":\"74215048.00\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(1071442800000)/\",\"OrganizationBPName1\":\"myBrand B.V.\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"4931 BM\",\"to_BusinessPartnerAddress.CityName\":\"Geertruidenberg\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"O\",\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\"560000.00\",\"ZZ1_legal_name_bus_bus\":\"myBrand B.V.\",\"ZZ1_paid_up_capi_bus_bus\":\"560000.00\",\"ZZ1_personnel_bus_bus\":\"306\",\"ZZ1_pers_fulltime_bus_bus\":\"306\",\"ZZ1_rsin_number_bus_bus\":\"812983178\",\"ZZ1_secsbicode_text_bu_bus\":\"Organisatie-adviesbureaus\",\"ZZ1_ultimateparent_cus_bus\":\"63854546\",\"to_BusinessPartnerTax.BPTaxNumber\":\"NL812983178B01\",\"SearchTerm2\":\"myBrand B.V.\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "String parsedMapping:\t{\"ZZ1_org_code_bus_bus\":\"O\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\"560000.00\",\"ZZ1_fin_turnover_bus_bus\":\"74215048.00\",\"OrganizationBPName1\":\"myBrand B.V.\",\"ZZ1_legal_name_bus_bus\":\"myBrand B.V.\",\"BusinessPartnerFullName\":\"myBrand B.V.\",\"ZZ1_Locationnumber_bus_bus\":\"000016341171\",\"ZZ1_rsin_number_bus_bus\":\"812983178\",\"ZZ1_secsbicode_text_bu_bus\":\"Organisatie-adviesbureaus\",\"BusinessPartnerName\":\"myBrand B.V.\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_ultimateparent_cus_bus\":\"63854546\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"306\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000016341171\",\"ZZ1_fin_profit_bus_bus\":\"10582800.00\",\"OrganizationFoundationDate\":\"/Date(1071442800000)/\",\"ZZ1_fin_assets_bus_bus\":\"29309246.00\",\"ZZ1_share_cap_bus_bus\":\"560000.00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"306\",\"SearchTerm2\":\"myBrand B.V.\",\"SearchTerm1\":\"myBrand B.V.\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Geertruidenberg\",\"HouseNumber\":\"1\",\"StreetName\":\"Venestraat\",\"Country\":\"NL\",\"PostalCode\":\"4931 BM\",\"Language\":\"NL\",\"to_URLAddress\":[{\"WebsiteURL\":\"www.mybrand.nl\"}]}],\"to_BusinessPartnerTax\":[{\"BPTaxNumber\":\"NL812983178B01\",\"BPTaxType\":\"NL0\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test3() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu9477:HeaderAuthenticate xmlns:nu9477=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">62bc6511562bf925040d374bc43ec1b5</reactid></nu9477:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">67214207</dossier_number><establishment_number xsi:type=\"xsd:string\">000035775068</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[5]\"><item xsi:type=\"xsd:string\">Establishment</item><item xsi:type=\"xsd:string\">Personnel</item><item xsi:type=\"xsd:string\">SubscriptionDates</item><item xsi:type=\"xsd:string\">Capital</item><item xsi:type=\"xsd:string\">Contact</item></update_types><date_last_update xsi:type=\"xsd:date\">2023-02-15</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">67214207</dossier_number><establishment_number xsi:type=\"xsd:string\">000035775068</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000035775068</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><chamber_number xsi:type=\"xsd:string\">34</chamber_number><legal_form_code xsi:type=\"xsd:string\">1</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Eenmanszaak</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">O</indication_organisation_code><legal_name xsi:type=\"xsd:string\"></legal_name><trade_name_45 xsi:type=\"xsd:string\">Praktijk Denken Voelen Doen</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Praktijk Denken Voelen Doen</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">MyBrandNewDays</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">2024KJ</postcode><city xsi:type=\"xsd:string\">HAARLEM</city><street xsi:type=\"xsd:string\">Mr. Jan Gerritszlaan</street><house_number xsi:type=\"xsd:int\">39</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">2024KJ</postcode><city xsi:type=\"xsd:string\">Haarlem</city><street xsi:type=\"xsd:string\">Mr. Jan Gerritszlaan</street><house_number xsi:type=\"xsd:int\">39</house_number><house_number_addition xsi:type=\"xsd:string\">III</house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">2024KJ</postcode><city xsi:type=\"xsd:string\">Haarlem</city><street xsi:type=\"xsd:string\">Mr. Jan Gerritszlaan</street><house_number xsi:type=\"xsd:int\">39</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">2024KJ</postcode><city xsi:type=\"xsd:string\">HAARLEM</city><street xsi:type=\"xsd:string\">Mr. Jan Gerritszlaan</street><house_number xsi:type=\"xsd:int\">39</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">2024KJ</postcode><city xsi:type=\"xsd:string\">Haarlem</city><street xsi:type=\"xsd:string\">Mr. Jan Gerritszlaan</street><house_number xsi:type=\"xsd:int\">39</house_number><house_number_addition xsi:type=\"xsd:string\">III</house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">2024KJ</postcode><city xsi:type=\"xsd:string\">Haarlem</city><street xsi:type=\"xsd:string\">Mr. Jan Gerritszlaan</street><house_number xsi:type=\"xsd:int\">39</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\"></telephone_number><mobile_number xsi:type=\"xsd:string\">06 15944111</mobile_number><domain_name xsi:type=\"xsd:string\">www.praktijkdenkenvoelendoen.nl</domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\">D.</contact_initials><contact_prefix xsi:type=\"xsd:string\">de</contact_prefix><contact_surname xsi:type=\"xsd:string\">Kruijk</contact_surname><contact_gender xsi:type=\"xsd:string\"></contact_gender><primary_sbi_code xsi:type=\"xsd:string\">85592</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\">85599</secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\">86919</secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Bedrijfsopleiding en -training</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\">Studiebegeleiding, vorming en onderwijs n.e.g.</secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\">Overige paramedische praktijken (geen fysiotherapie en psychologie) en alternatieve genezers</secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">1</personnel><class_personnel xsi:type=\"xsd:int\">2</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">0</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">1</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2017</year><month xsi:type=\"xsd:int\">6</month><day xsi:type=\"xsd:int\">22</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">false</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">true</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2016</year><month xsi:type=\"xsd:int\">11</month><day xsi:type=\"xsd:int\">4</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[3]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">85592</sbi_code><description xsi:type=\"xsd:string\">Bedrijfsopleiding en -training</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">85599</sbi_code><description xsi:type=\"xsd:string\">Studiebegeleiding, vorming en onderwijs n.e.g.</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">86919</sbi_code><description xsi:type=\"xsd:string\">Overige paramedische praktijken (geen fysiotherapie en psychologie) en alternatieve genezers</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[3]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">70221</sbi_code><description xsi:type=\"xsd:string\">Organisatie-adviesbureaus</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">85322</sbi_code><description xsi:type=\"xsd:string\">Educatie</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">85591</sbi_code><description xsi:type=\"xsd:string\">Afstandsonderwijs</description></item></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"><SOAP-ENV:Header><nu5816:HeaderAuthenticate xmlns:nu5816=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">12419aad22944c73cd90fafccf0593bf</reactid></nu5816:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><SOAP-ENV:Fault><faultcode>Server</faultcode><faultstring>Vat number for business not found</faultstring><faultactor></faultactor><detail><soapVal xsi:type=\"xsd:string\"></soapVal><errorcode xsi:type=\"xsd:string\">Server.Data.NotFound</errorcode></detail></SOAP-ENV:Fault></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(false, true);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);

            String mapping =
                "{\"BusinessPartnerFullName\":\"Praktijk Denken Voelen Doen\",\"to_BusinessPartnerAddress.to_URLAddress.WebsiteURL\":\"www.praktijkdenkenvoelendoen.nl\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000035775068\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Mr. Jan Gerritszlaan\",\"to_BusinessPartnerAddress.HouseNumber\":\"39\",\"FormOfAddress\":\"0003\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Praktijk Denken Voelen Doen\",\"ZZ1_Locationnumber_bus_bus\":\"000035775068\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(1478214000000)/\",\"OrganizationBPName1\":\"Praktijk Denken Voelen Doen\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"2024 KJ\",\"to_BusinessPartnerAddress.CityName\":\"Haarlem\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":true,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"O\",\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"1\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"ZZ1_secsbicode_text_bu_bus\":\"Studiebegeleiding, vorming en onderwijs n.e.g.\",\"SearchTerm2\":\"MyBrandNewDays\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";

            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);

            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"O\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Praktijk Denken Voelen Doen\",\"BusinessPartnerFullName\":\"Praktijk Denken Voelen Doen\",\"ZZ1_Locationnumber_bus_bus\":\"000035775068\",\"ZZ1_secsbicode_text_bu_bus\":\"Studiebegeleiding, vorming en onderwijs n.e.g.\",\"BusinessPartnerName\":\"Praktijk Denken Voelen Doen\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"1\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000035775068\",\"OrganizationFoundationDate\":\"/Date(1478214000000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"SearchTerm2\":\"MyBrandNewDays\",\"ZZ1_non_mail_bus_bus\":true,\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Haarlem\",\"HouseNumber\":\"39\",\"StreetName\":\"Mr. Jan Gerritszlaan\",\"Country\":\"NL\",\"PostalCode\":\"2024 KJ\",\"Language\":\"NL\",\"to_URLAddress\":[{\"WebsiteURL\":\"www.praktijkdenkenvoelendoen.nl\"}]}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLVN01\"},{\"BusinessPartnerRole\":\"FLVN00\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test4() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu6599:HeaderAuthenticate xmlns:nu6599=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">f41d44be7edad17026e1801792ece844</reactid></nu6599:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">20161986</dossier_number><establishment_number xsi:type=\"xsd:string\">000002499835</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Tradenames</item></update_types><date_last_update xsi:type=\"xsd:date\">2018-07-28</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">20161986</dossier_number><establishment_number xsi:type=\"xsd:string\">000002499835</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000002499835</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><rsin_number xsi:type=\"xsd:string\">821467323</rsin_number><chamber_number xsi:type=\"xsd:string\">20</chamber_number><legal_form_code xsi:type=\"xsd:string\">74</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Stichting</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">S</indication_organisation_code><legal_name xsi:type=\"xsd:string\">Stichting Zeeuws Vrouwenplatform</legal_name><trade_name_45 xsi:type=\"xsd:string\">Stichting Zeeuws Vrouwenplatform</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Stichting Zeeuws Vrouwenplatform</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Stichting Zeeuws Vrouwenplatform</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543AA</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Polderstraat</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543AA</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Polderstraat</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543AA</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Polderstraat</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543AA</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Polderstraat</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543AA</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Polderstraat</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543AA</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Polderstraat</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\">0115 431958</telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\">www.zeeuwsvrouwenplatform.nl</domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\">E.R.L.</contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\">Galama-Rommerts</contact_surname><contact_gender xsi:type=\"xsd:string\">f</contact_gender><primary_sbi_code xsi:type=\"xsd:string\">94997</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\"></secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Overige belangenbehartiging n.e.g.</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\"></secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">0</personnel><class_personnel xsi:type=\"xsd:int\">1</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">0</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">1</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2010</year><month xsi:type=\"xsd:int\">4</month><day xsi:type=\"xsd:int\">29</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">false</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><founding_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2009</year><month xsi:type=\"xsd:int\">10</month><day xsi:type=\"xsd:int\">21</day></founding_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2009</year><month xsi:type=\"xsd:int\">10</month><day xsi:type=\"xsd:int\">21</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[1]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">94997</sbi_code><description xsi:type=\"xsd:string\">Overige belangenbehartiging n.e.g.</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[2]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">88993</sbi_code><description xsi:type=\"xsd:string\">Lokaal welzijnswerk</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">94996</sbi_code><description xsi:type=\"xsd:string\">Overige ideële organisaties n.e.g.</description></item></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"><SOAP-ENV:Header><nu3905:HeaderAuthenticate xmlns:nu3905=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">d5732066fd1971f60b3a911a71256f35</reactid></nu3905:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><SOAP-ENV:Fault><faultcode>Server</faultcode><faultstring>Vat number for business not found</faultstring><faultactor></faultactor><detail><soapVal xsi:type=\"xsd:string\"></soapVal><errorcode xsi:type=\"xsd:string\">Server.Data.NotFound</errorcode></detail></SOAP-ENV:Fault></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, true);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"Stichting Zeeuws Vrouwenplatform\",\"to_BusinessPartnerAddress.to_URLAddress.WebsiteURL\":\"www.zeeuwsvrouwenplatform.nl\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000002499835\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Polderstraat\",\"to_BusinessPartnerAddress.HouseNumber\":\"9\",\"to_BusinessPartnerAddress.to_PhoneNumber.PhoneNumber\":\"0115 431958\",\"FormOfAddress\":\"0003\",\"SearchTerm1\":\"Stichting Zeeuws Vro\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Stichting Zeeuws Vrouwenplatform\",\"ZZ1_Locationnumber_bus_bus\":\"000002499835\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(1256076000000)/\",\"OrganizationBPName1\":\"Stichting Zeeuws Vrouwenplatform\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"4543 AA\",\"to_BusinessPartnerAddress.CityName\":\"Zaamslag\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"S\",\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_legal_name_bus_bus\":\"Stichting Zeeuws Vrouwenplatform\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"0\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"ZZ1_rsin_number_bus_bus\":\"821467323\",\"SearchTerm2\":\"Stichting Zeeuws Vro\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"S\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Stichting Zeeuws Vrouwenplatform\",\"ZZ1_legal_name_bus_bus\":\"Stichting Zeeuws Vrouwenplatform\",\"BusinessPartnerFullName\":\"Stichting Zeeuws Vrouwenplatform\",\"ZZ1_Locationnumber_bus_bus\":\"000002499835\",\"ZZ1_rsin_number_bus_bus\":\"821467323\",\"BusinessPartnerName\":\"Stichting Zeeuws Vrouwenplatform\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"0\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000002499835\",\"OrganizationFoundationDate\":\"/Date(1256076000000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"SearchTerm2\":\"Stichting Zeeuws Vro\",\"SearchTerm1\":\"Stichting Zeeuws Vro\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Zaamslag\",\"HouseNumber\":\"9\",\"StreetName\":\"Polderstraat\",\"Country\":\"NL\",\"PostalCode\":\"4543 AA\",\"Language\":\"NL\",\"to_URLAddress\":[{\"WebsiteURL\":\"www.zeeuwsvrouwenplatform.nl\"}]}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"},{\"BusinessPartnerRole\":\"FLVN01\"},{\"BusinessPartnerRole\":\"FLVN00\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_5() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu3618:HeaderAuthenticate xmlns:nu3618=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">9373e17ddf7152bbc822698432178bfa</reactid></nu3618:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">21010276</dossier_number><establishment_number xsi:type=\"xsd:string\">000005997518</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[5]\"><item xsi:type=\"xsd:string\">Establishment</item><item xsi:type=\"xsd:string\">EstablishmentAddress</item><item xsi:type=\"xsd:string\">SubscriptionDates</item><item xsi:type=\"xsd:string\">Personnel</item><item xsi:type=\"xsd:string\">CorrespondenceAddress</item></update_types><date_last_update xsi:type=\"xsd:date\">2018-03-08</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">21010276</dossier_number><establishment_number xsi:type=\"xsd:string\">000005997518</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000005997534</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">false</indication_main_establishment><chamber_number xsi:type=\"xsd:string\">20</chamber_number><legal_form_code xsi:type=\"xsd:string\">1</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Eenmanszaak</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">O</indication_organisation_code><legal_name xsi:type=\"xsd:string\"></legal_name><trade_name_45 xsi:type=\"xsd:string\">Hatéka Assurantie- en Makelaarskantoor</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Hatéka Assurantie- en Makelaarskantoor</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[5]\"><item xsi:type=\"xsd:string\">Hatéka Assurantie- en Makelaarskantoor</item><item xsi:type=\"xsd:string\">Hatéka financieel advies</item><item xsi:type=\"xsd:string\">Hatéka makelaar o.g. o.z.</item><item xsi:type=\"xsd:string\">Hatéka verzekeringen</item><item xsi:type=\"xsd:string\">Hatéka verzekeringen financieel advies en makelaardij o.z.</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4542BJ</postcode><city xsi:type=\"xsd:string\">Hoek</city><street xsi:type=\"xsd:string\">Molendijk</street><house_number xsi:type=\"xsd:int\">14</house_number><house_number_addition xsi:type=\"xsd:string\">a</house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4542BJ</postcode><city xsi:type=\"xsd:string\">Hoek</city><street xsi:type=\"xsd:string\">Molendijk</street><house_number xsi:type=\"xsd:int\">14</house_number><house_number_addition xsi:type=\"xsd:string\">a</house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4542BJ</postcode><city xsi:type=\"xsd:string\">Hoek</city><street xsi:type=\"xsd:string\">Molendijk</street><house_number xsi:type=\"xsd:int\">14</house_number><house_number_addition xsi:type=\"xsd:string\">a</house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543BH</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Plein</street><house_number xsi:type=\"xsd:int\">12</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543BH</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Plein</street><house_number xsi:type=\"xsd:int\">12</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543BH</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Plein</street><house_number xsi:type=\"xsd:int\">12</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\">0115 441370</telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\">C.</contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\">Hamelink</contact_surname><contact_gender xsi:type=\"xsd:string\">m</contact_gender><primary_sbi_code xsi:type=\"xsd:string\">6622</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\">66193</secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\">6831</secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Assurantietussenpersonen</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\">Hypotheek- en kredietbemiddeling, geldwisselkantoren, bank- en spaaragentschappen e.d.</secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\">Bemiddeling bij handel, huur of verhuur van onroerend goed</secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">2</personnel><class_personnel xsi:type=\"xsd:int\">3</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">1</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">2</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2003</year><month xsi:type=\"xsd:int\">11</month><day xsi:type=\"xsd:int\">21</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">true</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><continuation_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2003</year><month xsi:type=\"xsd:int\">11</month><day xsi:type=\"xsd:int\">1</day></continuation_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">1970</year><month xsi:type=\"xsd:int\">1</month><day xsi:type=\"xsd:int\">1</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[3]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">6622</sbi_code><description xsi:type=\"xsd:string\">Assurantietussenpersonen</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">66193</sbi_code><description xsi:type=\"xsd:string\">Hypotheek- en kredietbemiddeling, geldwisselkantoren, bank- en spaaragentschappen e.d.</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">6831</sbi_code><description xsi:type=\"xsd:string\">Bemiddeling bij handel, huur of verhuur van onroerend goed</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[0]\"></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"><SOAP-ENV:Header><nu8462:HeaderAuthenticate xmlns:nu8462=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">8cd47e8096963e35ad67374e43145963</reactid></nu8462:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><SOAP-ENV:Fault><faultcode>Server</faultcode><faultstring>Vat number for business not found</faultstring><faultactor></faultactor><detail><soapVal xsi:type=\"xsd:string\"></soapVal><errorcode xsi:type=\"xsd:string\">Server.Data.NotFound</errorcode></detail></SOAP-ENV:Fault></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, true);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"Hatéka Assurantie- en Makelaarskantoor\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000005997518\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Molendijk\",\"to_BusinessPartnerAddress.HouseNumber\":\"14\",\"to_BusinessPartnerAddress.to_PhoneNumber.PhoneNumber\":\"0115 441370\",\"FormOfAddress\":\"0003\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Hatéka Assurantie- en Makelaarskantoor\",\"ZZ1_Locationnumber_bus_bus\":\"000005997518\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(-3600000)/\",\"OrganizationBPName1\":\"Hatéka Assurantie- en Makelaarskantoor\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"4542 BJ\",\"to_BusinessPartnerAddress.CityName\":\"Hoek\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"O\",\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"2\",\"ZZ1_pers_fulltime_bus_bus\":\"1\",\"ZZ1_secsbicode_text_bu_bus\":\"Hypotheek- en kredietbemiddeling, geldwisselkantoren, bank- en spaaragentschappen e.d.\",\"SearchTerm2\":\"Hatéka Assurantie- e\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";

            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);

            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"O\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Hatéka Assurantie- en Makelaarskantoor\",\"BusinessPartnerFullName\":\"Hatéka Assurantie- en Makelaarskantoor\",\"ZZ1_Locationnumber_bus_bus\":\"000005997518\",\"ZZ1_secsbicode_text_bu_bus\":\"Hypotheek- en kredietbemiddeling, geldwisselkantoren, bank- en spaaragentschappen e.d.\",\"BusinessPartnerName\":\"Hatéka Assurantie- en Makelaarskantoor\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"2\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000005997518\",\"OrganizationFoundationDate\":\"/Date(-3600000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"1\",\"SearchTerm2\":\"Hatéka Assurantie- e\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Hoek\",\"HouseNumber\":\"14\",\"StreetName\":\"Molendijk\",\"Country\":\"NL\",\"PostalCode\":\"4542 BJ\",\"Language\":\"NL\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"},{\"BusinessPartnerRole\":\"FLVN01\"},{\"BusinessPartnerRole\":\"FLVN00\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_6() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu2214:HeaderAuthenticate xmlns:nu2214=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">f9ecebfbb28fb9f9df8b8c43f4f984f4</reactid></nu2214:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">21005686</dossier_number><establishment_number xsi:type=\"xsd:string\">000008707820</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Tradenames</item></update_types><date_last_update xsi:type=\"xsd:date\">2018-07-27</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">21005686</dossier_number><establishment_number xsi:type=\"xsd:string\">000008707820</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000008708029</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">false</indication_main_establishment><rsin_number xsi:type=\"xsd:string\">009864362</rsin_number><chamber_number xsi:type=\"xsd:string\">20</chamber_number><legal_form_code xsi:type=\"xsd:string\">11</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Vennootschap onder firma</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">O</indication_organisation_code><legal_name xsi:type=\"xsd:string\">Fa. J. Dekker en Zoon</legal_name><trade_name_45 xsi:type=\"xsd:string\">Fa. Dekker en Zoon Aannemingsbedr &amp; Hobbyhuis</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Fa. Dekker en Zoon Aannemingsbedrijf en Hobbyhuis</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Fa. Dekker en Zoon Aannemingsbedrijf en Hobbyhuis</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543BR</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Kiezelstraat</street><house_number xsi:type=\"xsd:int\">4</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543BR</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Kiezelstraat</street><house_number xsi:type=\"xsd:int\">4</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543BR</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Kiezelstraat</street><house_number xsi:type=\"xsd:int\">4</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543BM</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Terneuzensestraat</street><house_number xsi:type=\"xsd:int\">27</house_number><house_number_addition xsi:type=\"xsd:string\">-29</house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">4543BM</postcode><city xsi:type=\"xsd:string\">Zaamslag</city><street xsi:type=\"xsd:string\">Terneuzensestraat</street><house_number xsi:type=\"xsd:int\">27</house_number><house_number_addition xsi:type=\"xsd:string\">-29</house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\">0115 431235</telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\">J.M.</contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\">Dekker</contact_surname><contact_gender xsi:type=\"xsd:string\">m</contact_gender><primary_sbi_code xsi:type=\"xsd:string\">52109</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\"></secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Opslag in distributiecentra en overige opslag (niet in tanks, koelhuizen e.d.)</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\"></secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">1</personnel><class_personnel xsi:type=\"xsd:int\">2</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">0</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">1</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2007</year><month xsi:type=\"xsd:int\">6</month><day xsi:type=\"xsd:int\">27</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">true</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><continuation_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">1998</year><month xsi:type=\"xsd:int\">1</month><day xsi:type=\"xsd:int\">1</day></continuation_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">1981</year><month xsi:type=\"xsd:int\">12</month><day xsi:type=\"xsd:int\">1</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[1]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">52109</sbi_code><description xsi:type=\"xsd:string\">Opslag in distributiecentra en overige opslag (niet in tanks, koelhuizen e.d.)</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[0]\"></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu9902:HeaderAuthenticate xmlns:nu9902=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">20660dbce35d423274d6d206d6526009</reactid></nu9902:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetVatNumberResponse><out xsi:type=\"tns:DutchBusinessVatNumber\"><dossier_number xsi:type=\"xsd:string\">21005686</dossier_number><vat_number xsi:type=\"xsd:string\">NL009864362B01</vat_number><date_last_update xsi:type=\"xsd:date\">2015-05-24</date_last_update></out></dutchBusinessGetVatNumberResponse></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, true);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);

            String mapping =
                "{\"BusinessPartnerFullName\":\"Fa. Dekker en Zoon Aannemingsbedrijf en Hobbyhuis\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000008707820\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Kiezelstraat\",\"to_BusinessPartnerAddress.HouseNumber\":\"4\",\"to_BusinessPartnerAddress.to_PhoneNumber.PhoneNumber\":\"0115 431235\",\"FormOfAddress\":\"0003\",\"SearchTerm1\":\"Fa. J. Dekker en Zoo\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Fa. Dekker en Zoon Aannemingsbedr & Hobbyhuis\",\"ZZ1_Locationnumber_bus_bus\":\"000008707820\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(376009200000)/\",\"OrganizationBPName1\":\"Fa. Dekker en Zoon Aannemingsbedr & Hobb\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"4543 BR\",\"to_BusinessPartnerAddress.CityName\":\"Zaamslag\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"O\",\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_legal_name_bus_bus\":\"Fa. J. Dekker en Zoon\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"1\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"ZZ1_rsin_number_bus_bus\":\"009864362\",\"to_BusinessPartnerTax.BPTaxNumber\":\"NL009864362B01\",\"SearchTerm2\":\"Fa. Dekker en Zoon A\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"O\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Fa. Dekker en Zoon Aannemingsbedr & Hobb\",\"ZZ1_legal_name_bus_bus\":\"Fa. J. Dekker en Zoon\",\"BusinessPartnerFullName\":\"Fa. Dekker en Zoon Aannemingsbedrijf en Hobbyhuis\",\"ZZ1_Locationnumber_bus_bus\":\"000008707820\",\"ZZ1_rsin_number_bus_bus\":\"009864362\",\"BusinessPartnerName\":\"Fa. Dekker en Zoon Aannemingsbedr & Hobbyhuis\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"1\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000008707820\",\"OrganizationFoundationDate\":\"/Date(376009200000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"SearchTerm2\":\"Fa. Dekker en Zoon A\",\"SearchTerm1\":\"Fa. J. Dekker en Zoo\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Zaamslag\",\"HouseNumber\":\"4\",\"StreetName\":\"Kiezelstraat\",\"Country\":\"NL\",\"PostalCode\":\"4543 BR\",\"Language\":\"NL\"}],\"to_BusinessPartnerTax\":[{\"BPTaxNumber\":\"NL009864362B01\",\"BPTaxType\":\"NL0\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"},{\"BusinessPartnerRole\":\"FLVN01\"},{\"BusinessPartnerRole\":\"FLVN00\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_7() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"httpschemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu2340:HeaderAuthenticate xmlns:nu2340=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">5971a194465ccf9f2ec1927ce2e88235</reactid></nu2340:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">37162183</dossier_number><establishment_number xsi:type=\"xsd:string\">000008621713</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Tradenames</item></update_types><date_last_update xsi:type=\"xsd:date\">2023-05-19</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">37162183</dossier_number><establishment_number xsi:type=\"xsd:string\">000008621713</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000008621713</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><rsin_number xsi:type=\"xsd:string\">822080369</rsin_number><chamber_number xsi:type=\"xsd:string\">37</chamber_number><legal_form_code xsi:type=\"xsd:string\">41</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Besloten Vennootschap met gewone structuur</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">O</indication_organisation_code><legal_name xsi:type=\"xsd:string\">R. Veenman Beheer B.V.</legal_name><trade_name_45 xsi:type=\"xsd:string\">R. Veenman Beheer B.V.</trade_name_45><trade_name_full xsi:type=\"xsd:string\">R. Veenman Beheer B.V.</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">R. Veenman Beheer B.V.</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483CH</postcode><city xsi:type=\"xsd:string\">DE RIJP</city><street xsi:type=\"xsd:string\">Fluytschip</street><house_number xsi:type=\"xsd:int\">15</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483CH</postcode><city xsi:type=\"xsd:string\">De Rijp</city><street xsi:type=\"xsd:string\">Fluytschip</street><house_number xsi:type=\"xsd:int\">15</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483CH</postcode><city xsi:type=\"xsd:string\">De Rijp</city><street xsi:type=\"xsd:string\">Fluytschip</street><house_number xsi:type=\"xsd:int\">15</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483CH</postcode><city xsi:type=\"xsd:string\">DE RIJP</city><street xsi:type=\"xsd:string\">Fluytschip</street><house_number xsi:type=\"xsd:int\">15</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483CH</postcode><city xsi:type=\"xsd:string\">De Rijp</city><street xsi:type=\"xsd:string\">Fluytschip</street><house_number xsi:type=\"xsd:int\">15</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483CH</postcode><city xsi:type=\"xsd:string\">De Rijp</city><street xsi:type=\"xsd:string\">Fluytschip</street><house_number xsi:type=\"xsd:int\">15</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\"></telephone_number><mobile_number xsi:type=\"xsd:string\">06 20620700</mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\">R.</contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\">Veenman</contact_surname><contact_gender xsi:type=\"xsd:string\"></contact_gender><primary_sbi_code xsi:type=\"xsd:string\">6420</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\"></secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Financiële holdings</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\"></secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">0</personnel><class_personnel xsi:type=\"xsd:int\">1</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">0</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">1</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2010</year><month xsi:type=\"xsd:int\">2</month><day xsi:type=\"xsd:int\">26</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">false</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">true</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">18000</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">18000</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><founding_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2010</year><month xsi:type=\"xsd:int\">2</month><day xsi:type=\"xsd:int\">26</day></founding_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2010</year><month xsi:type=\"xsd:int\">2</month><day xsi:type=\"xsd:int\">26</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[1]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">6420</sbi_code><description xsi:type=\"xsd:string\">Financiële holdings</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[0]\"></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"><SOAP-ENV:Header><nu4211:HeaderAuthenticate xmlns:nu4211=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">8905cc98e9b19b92a69e6554e93207ff</reactid></nu4211:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><SOAP-ENV:Fault><faultcode>Server</faultcode><faultstring>Vat number for business not found</faultstring><faultactor></faultactor><detail><soapVal xsi:type=\"xsd:string\"></soapVal><errorcode xsi:type=\"xsd:string\">Server.Data.NotFound</errorcode></detail></SOAP-ENV:Fault></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, false);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"R. Veenman Beheer B.V.\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000008621713\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Fluytschip\",\"to_BusinessPartnerAddress.HouseNumber\":\"15\",\"FormOfAddress\":\"0003\",\"SearchTerm1\":\"R. Veenman Beheer B.\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"R. Veenman Beheer B.V.\",\"ZZ1_Locationnumber_bus_bus\":\"000008621713\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(1267138800000)/\",\"OrganizationBPName1\":\"R. Veenman Beheer B.V.\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"1483 CH\",\"to_BusinessPartnerAddress.CityName\":\"De Rijp\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":true,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"O\",\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\"18000.00\",\"ZZ1_legal_name_bus_bus\":\"R. Veenman Beheer B.V.\",\"ZZ1_paid_up_capi_bus_bus\":\"18000.00\",\"ZZ1_personnel_bus_bus\":\"0\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"ZZ1_rsin_number_bus_bus\":\"822080369\",\"SearchTerm2\":\"R. Veenman Beheer B.\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"O\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\"18000.00\",\"OrganizationBPName1\":\"R. Veenman Beheer B.V.\",\"ZZ1_legal_name_bus_bus\":\"R. Veenman Beheer B.V.\",\"BusinessPartnerFullName\":\"R. Veenman Beheer B.V.\",\"ZZ1_Locationnumber_bus_bus\":\"000008621713\",\"ZZ1_rsin_number_bus_bus\":\"822080369\",\"BusinessPartnerName\":\"R. Veenman Beheer B.V.\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"0\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000008621713\",\"OrganizationFoundationDate\":\"/Date(1267138800000)/\",\"ZZ1_share_cap_bus_bus\":\"18000.00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"SearchTerm2\":\"R. Veenman Beheer B.\",\"SearchTerm1\":\"R. Veenman Beheer B.\",\"ZZ1_non_mail_bus_bus\":true,\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"De Rijp\",\"HouseNumber\":\"15\",\"StreetName\":\"Fluytschip\",\"Country\":\"NL\",\"PostalCode\":\"1483 CH\",\"Language\":\"NL\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_8() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu6147:HeaderAuthenticate xmlns:nu6147=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">7d9e83e101e26af54e67a9dc237b4aaa</reactid></nu6147:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">37091343</dossier_number><establishment_number xsi:type=\"xsd:string\">000004338790</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Tradenames</item></update_types><date_last_update xsi:type=\"xsd:date\">2018-08-14</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">37091343</dossier_number><establishment_number xsi:type=\"xsd:string\">000004338790</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000004338790</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><rsin_number xsi:type=\"xsd:string\">809219475</rsin_number><chamber_number xsi:type=\"xsd:string\">37</chamber_number><legal_form_code xsi:type=\"xsd:string\">41</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Besloten Vennootschap met gewone structuur</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">O</indication_organisation_code><legal_name xsi:type=\"xsd:string\">W. Schouten Holding B.V.</legal_name><trade_name_45 xsi:type=\"xsd:string\">W. Schouten Holding B.V.</trade_name_45><trade_name_full xsi:type=\"xsd:string\">W. Schouten Holding B.V.</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">W. Schouten Holding B.V.</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483GA</postcode><city xsi:type=\"xsd:string\">DE RIJP</city><street xsi:type=\"xsd:string\">De Volger</street><house_number xsi:type=\"xsd:int\">6</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483GA</postcode><city xsi:type=\"xsd:string\">De Rijp</city><street xsi:type=\"xsd:string\">De Volger</street><house_number xsi:type=\"xsd:int\">6</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483GA</postcode><city xsi:type=\"xsd:string\">De Rijp</city><street xsi:type=\"xsd:string\">De Volger</street><house_number xsi:type=\"xsd:int\">6</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483GA</postcode><city xsi:type=\"xsd:string\">DE RIJP</city><street xsi:type=\"xsd:string\">De Volger</street><house_number xsi:type=\"xsd:int\">6</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483GA</postcode><city xsi:type=\"xsd:string\">De Rijp</city><street xsi:type=\"xsd:string\">De Volger</street><house_number xsi:type=\"xsd:int\">6</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">1483GA</postcode><city xsi:type=\"xsd:string\">De Rijp</city><street xsi:type=\"xsd:string\">De Volger</street><house_number xsi:type=\"xsd:int\">6</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\">072 5640406</telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\">W.</contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\">Schouten</contact_surname><contact_gender xsi:type=\"xsd:string\"></contact_gender><primary_sbi_code xsi:type=\"xsd:string\">6420</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\"></secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Financiële holdings</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\"></secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">0</personnel><class_personnel xsi:type=\"xsd:int\">1</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">0</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">1</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2010</year><month xsi:type=\"xsd:int\">1</month><day xsi:type=\"xsd:int\">29</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">false</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">6718000</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">6718000</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><founding_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2000</year><month xsi:type=\"xsd:int\">9</month><day xsi:type=\"xsd:int\">27</day></founding_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2006</year><month xsi:type=\"xsd:int\">5</month><day xsi:type=\"xsd:int\">8</day></establishment_date><annual_financial_statement_summary xsi:type=\"tns:DutchBusinessAnnualFinancialStatementSummary\"><year xsi:type=\"xsd:int\">2019</year><assets xsi:type=\"tns:DutchBusinessMoneyV2\"><amount xsi:type=\"xsd:long\">7364295</amount><currency xsi:type=\"xsd:string\">EUR</currency><formatted xsi:type=\"xsd:string\">EUR 7.364.295,00</formatted></assets></annual_financial_statement_summary><structure xsi:type=\"tns:DutchBusinessStructure\"><number_of_subsidiaries xsi:type=\"xsd:int\">9</number_of_subsidiaries></structure><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[1]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">6420</sbi_code><description xsi:type=\"xsd:string\">Financiële holdings</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[0]\"></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"><SOAP-ENV:Header><nu9969:HeaderAuthenticate xmlns:nu9969=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">3ec460b6f9d24eb799f8d19a4c3c2f15</reactid></nu9969:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><SOAP-ENV:Fault><faultcode>Server</faultcode><faultstring>Vat number for business not found</faultstring><faultactor></faultactor><detail><soapVal xsi:type=\"xsd:string\"></soapVal><errorcode xsi:type=\"xsd:string\">Server.Data.NotFound</errorcode></detail></SOAP-ENV:Fault></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, true);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"W. Schouten Holding B.V.\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000004338790\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"De Volger\",\"to_BusinessPartnerAddress.HouseNumber\":\"6\",\"to_BusinessPartnerAddress.to_PhoneNumber.PhoneNumber\":\"072 5640406\",\"FormOfAddress\":\"0003\",\"SearchTerm1\":\"W. Schouten Holding \",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"W. Schouten Holding B.V.\",\"ZZ1_Locationnumber_bus_bus\":\"000004338790\",\"ZZ1_fin_assets_bus_bus\":\"7364295.00\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(1147039200000)/\",\"OrganizationBPName1\":\"W. Schouten Holding B.V.\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"1483 GA\",\"to_BusinessPartnerAddress.CityName\":\"De Rijp\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"O\",\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\"6718000.00\",\"ZZ1_legal_name_bus_bus\":\"W. Schouten Holding B.V.\",\"ZZ1_paid_up_capi_bus_bus\":\"6718000.00\",\"ZZ1_personnel_bus_bus\":\"0\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"ZZ1_rsin_number_bus_bus\":\"809219475\",\"SearchTerm2\":\"W. Schouten Holding \",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"O\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\"6718000.00\",\"OrganizationBPName1\":\"W. Schouten Holding B.V.\",\"ZZ1_legal_name_bus_bus\":\"W. Schouten Holding B.V.\",\"BusinessPartnerFullName\":\"W. Schouten Holding B.V.\",\"ZZ1_Locationnumber_bus_bus\":\"000004338790\",\"ZZ1_rsin_number_bus_bus\":\"809219475\",\"BusinessPartnerName\":\"W. Schouten Holding B.V.\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"0\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000004338790\",\"OrganizationFoundationDate\":\"/Date(1147039200000)/\",\"ZZ1_fin_assets_bus_bus\":\"7364295.00\",\"ZZ1_share_cap_bus_bus\":\"6718000.00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"SearchTerm2\":\"W. Schouten Holding \",\"SearchTerm1\":\"W. Schouten Holding \",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"De Rijp\",\"HouseNumber\":\"6\",\"StreetName\":\"De Volger\",\"Country\":\"NL\",\"PostalCode\":\"1483 GA\",\"Language\":\"NL\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"},{\"BusinessPartnerRole\":\"FLVN01\"},{\"BusinessPartnerRole\":\"FLVN00\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_9() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu4220:HeaderAuthenticate xmlns:nu4220=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">d27846943c49d0d1474f40820ecd44cc</reactid></nu4220:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">34075746</dossier_number><establishment_number xsi:type=\"xsd:string\">000004110048</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Tradenames</item></update_types><date_last_update xsi:type=\"xsd:date\">2019-06-05</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">34075746</dossier_number><establishment_number xsi:type=\"xsd:string\">000004110048</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000004110048</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><chamber_number xsi:type=\"xsd:string\">01</chamber_number><legal_form_code xsi:type=\"xsd:string\">1</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Eenmanszaak</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">O</indication_organisation_code><legal_name xsi:type=\"xsd:string\"></legal_name><trade_name_45 xsi:type=\"xsd:string\">Metsel- en Aannemersbedrijf Lolo</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Metsel- en Aannemersbedrijf Lolo</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[2]\"><item xsi:type=\"xsd:string\">Bouwkeurings Bureau Het Huis</item><item xsi:type=\"xsd:string\">Metsel- en Aannemersbedrijf Lolo</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831AH</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Weerdingerkanaal ZZ</street><house_number xsi:type=\"xsd:int\">120</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831AH</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Weerdingerkanaal ZZ</street><house_number xsi:type=\"xsd:int\">120</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831AH</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Weerdingerkanaal ZZ</street><house_number xsi:type=\"xsd:int\">120</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831AH</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Weerdingerkanaal ZZ</street><house_number xsi:type=\"xsd:int\">120</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831AH</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Weerdingerkanaal ZZ</street><house_number xsi:type=\"xsd:int\">120</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831AH</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Weerdingerkanaal ZZ</street><house_number xsi:type=\"xsd:int\">120</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\"></telephone_number><mobile_number xsi:type=\"xsd:string\">06 22237178</mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\">L.</contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\">Schipper</contact_surname><contact_gender xsi:type=\"xsd:string\">m</contact_gender><primary_sbi_code xsi:type=\"xsd:string\">43993</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\">4120</secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Metselen en voegen</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\">Algemene burgerlijke en utiliteitsbouw</secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">3</personnel><class_personnel xsi:type=\"xsd:int\">3</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">3</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">3</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2006</year><month xsi:type=\"xsd:int\">1</month><day xsi:type=\"xsd:int\">10</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">true</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><continuation_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">1993</year><month xsi:type=\"xsd:int\">8</month><day xsi:type=\"xsd:int\">16</day></continuation_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">1991</year><month xsi:type=\"xsd:int\">9</month><day xsi:type=\"xsd:int\">17</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[2]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">43993</sbi_code><description xsi:type=\"xsd:string\">Metselen en voegen</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">4120</sbi_code><description xsi:type=\"xsd:string\">Algemene burgerlijke en utiliteitsbouw</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[0]\"></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"><SOAP-ENV:Header><nu4758:HeaderAuthenticate xmlns:nu4758=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">fdec02947ae0bef68b004fe48b07c090</reactid></nu4758:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><SOAP-ENV:Fault><faultcode>Server</faultcode><faultstring>Vat number for business not found</faultstring><faultactor></faultactor><detail><soapVal xsi:type=\"xsd:string\"></soapVal><errorcode xsi:type=\"xsd:string\">Server.Data.NotFound</errorcode></detail></SOAP-ENV:Fault></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, false);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);

            String mapping =
                "{\"BusinessPartnerFullName\":\"Metsel- en Aannemersbedrijf Lolo\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000004110048\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Weerdingerkanaal ZZ\",\"to_BusinessPartnerAddress.HouseNumber\":\"120\",\"FormOfAddress\":\"0003\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Metsel- en Aannemersbedrijf Lolo\",\"ZZ1_Locationnumber_bus_bus\":\"000004110048\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(685058400000)/\",\"OrganizationBPName1\":\"Metsel- en Aannemersbedrijf Lolo\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"7831 AH\",\"to_BusinessPartnerAddress.CityName\":\"Nieuw-Weerdinge\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"O\",\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"3\",\"ZZ1_pers_fulltime_bus_bus\":\"3\",\"ZZ1_secsbicode_text_bu_bus\":\"Algemene burgerlijke en utiliteitsbouw\",\"SearchTerm2\":\"Bouwkeurings Bureau \",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"O\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Metsel- en Aannemersbedrijf Lolo\",\"BusinessPartnerFullName\":\"Metsel- en Aannemersbedrijf Lolo\",\"ZZ1_Locationnumber_bus_bus\":\"000004110048\",\"ZZ1_secsbicode_text_bu_bus\":\"Algemene burgerlijke en utiliteitsbouw\",\"BusinessPartnerName\":\"Metsel- en Aannemersbedrijf Lolo\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"3\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000004110048\",\"OrganizationFoundationDate\":\"/Date(685058400000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"3\",\"SearchTerm2\":\"Bouwkeurings Bureau \",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Nieuw-Weerdinge\",\"HouseNumber\":\"120\",\"StreetName\":\"Weerdingerkanaal ZZ\",\"Country\":\"NL\",\"PostalCode\":\"7831 AH\",\"Language\":\"NL\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_10() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu3391:HeaderAuthenticate xmlns:nu3391=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">ea5b73feca40d8b51b9acae2d04bf786</reactid></nu3391:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">41017079</dossier_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Activity</item></update_types><date_last_update xsi:type=\"xsd:date\">2014-04-28</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">41017079</dossier_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><rsin_number xsi:type=\"xsd:string\">816648657</rsin_number><chamber_number xsi:type=\"xsd:string\">01</chamber_number><legal_form_code xsi:type=\"xsd:string\">74</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Stichting</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">S</indication_organisation_code><legal_name xsi:type=\"xsd:string\">Stichting Sociaal-Kultureelwerk Nieuw-Weerdinge en omgeving</legal_name><trade_name_45 xsi:type=\"xsd:string\">Stichting Sociaal-Kultureelwerk</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Stichting Sociaal-Kultureelwerk</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[0]\"></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831BA</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Eerste Kruisdiep OZ</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831BA</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Eerste Kruisdiep OZ</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831BA</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Eerste Kruisdiep OZ</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831BA</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Eerste Kruisdiep OZ</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831BA</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Eerste Kruisdiep OZ</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7831BA</postcode><city xsi:type=\"xsd:string\">Nieuw-Weerdinge</city><street xsi:type=\"xsd:string\">Eerste Kruisdiep OZ</street><house_number xsi:type=\"xsd:int\">9</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\"></telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\"></contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\"></contact_surname><contact_gender xsi:type=\"xsd:string\"></contact_gender><primary_sbi_code xsi:type=\"xsd:string\">88993</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\"></secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Lokaal welzijnswerk</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\"></secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">0</personnel><class_personnel xsi:type=\"xsd:int\">1</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">0</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">1</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2006</year><month xsi:type=\"xsd:int\">5</month><day xsi:type=\"xsd:int\">1</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_economically_active xsi:type=\"xsd:boolean\">false</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><founding_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">1974</year><month xsi:type=\"xsd:int\">1</month><day xsi:type=\"xsd:int\">30</day></founding_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">1974</year><month xsi:type=\"xsd:int\">1</month><day xsi:type=\"xsd:int\">30</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[1]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">88993</sbi_code><description xsi:type=\"xsd:string\">Lokaal welzijnswerk</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[0]\"></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"><SOAP-ENV:Header><nu4407:HeaderAuthenticate xmlns:nu4407=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">dcd3d029fc4ee9903869f8877d93a561</reactid></nu4407:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><SOAP-ENV:Fault><faultcode>Server</faultcode><faultstring>Vat number for business not found</faultstring><faultactor></faultactor><detail><soapVal xsi:type=\"xsd:string\"></soapVal><errorcode xsi:type=\"xsd:string\">Server.Data.NotFound</errorcode></detail></SOAP-ENV:Fault></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, true);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"Stichting Sociaal-Kultureelwerk\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"41017079\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Eerste Kruisdiep OZ\",\"to_BusinessPartnerAddress.HouseNumber\":\"9\",\"FormOfAddress\":\"0003\",\"SearchTerm1\":\"Stichting Sociaal-Ku\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Stichting Sociaal-Kultureelwerk\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(128732400000)/\",\"OrganizationBPName1\":\"Stichting Sociaal-Kultureelwerk\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"7831 BA\",\"to_BusinessPartnerAddress.CityName\":\"Nieuw-Weerdinge\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"S\",\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_legal_name_bus_bus\":\"Stichting Sociaal-Kultureelwerk Nieuw-Weerdinge en omgeving\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"0\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"ZZ1_rsin_number_bus_bus\":\"816648657\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"S\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Stichting Sociaal-Kultureelwerk\",\"ZZ1_legal_name_bus_bus\":\"Stichting Sociaal-Kultureelwerk Nieuw-Weerdinge en omgeving\",\"BusinessPartnerFullName\":\"Stichting Sociaal-Kultureelwerk\",\"ZZ1_rsin_number_bus_bus\":\"816648657\",\"BusinessPartnerName\":\"Stichting Sociaal-Kultureelwerk\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"0\",\"to_BuPaIdentification.BPIdentificationNumber\":\"41017079\",\"OrganizationFoundationDate\":\"/Date(128732400000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"SearchTerm1\":\"Stichting Sociaal-Ku\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Nieuw-Weerdinge\",\"HouseNumber\":\"9\",\"StreetName\":\"Eerste Kruisdiep OZ\",\"Country\":\"NL\",\"PostalCode\":\"7831 BA\",\"Language\":\"NL\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"},{\"BusinessPartnerRole\":\"FLVN01\"},{\"BusinessPartnerRole\":\"FLVN00\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_11() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu8926:HeaderAuthenticate xmlns:nu8926=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">16d62640186f068df39e59b01883e9dd</reactid></nu8926:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">41005674</dossier_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[2]\"><item xsi:type=\"xsd:string\">EstablishmentAddress</item><item xsi:type=\"xsd:string\">CorrespondenceAddress</item></update_types><date_last_update xsi:type=\"xsd:date\">2012-02-24</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">41005674</dossier_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><rsin_number xsi:type=\"xsd:string\">806054232</rsin_number><chamber_number xsi:type=\"xsd:string\">01</chamber_number><legal_form_code xsi:type=\"xsd:string\">74</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Stichting</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">S</indication_organisation_code><legal_name xsi:type=\"xsd:string\">Stichting Apollo Makkum</legal_name><trade_name_45 xsi:type=\"xsd:string\">Stichting Apollo Makkum</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Stichting Apollo Makkum</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[0]\"></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754KK</postcode><city xsi:type=\"xsd:string\">Makkum</city><street xsi:type=\"xsd:string\">It Med</street><house_number xsi:type=\"xsd:int\">3</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754KK</postcode><city xsi:type=\"xsd:string\">Makkum</city><street xsi:type=\"xsd:string\">It Mêd</street><house_number xsi:type=\"xsd:int\">3</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754KK</postcode><city xsi:type=\"xsd:string\">Makkum</city><street xsi:type=\"xsd:string\">It Med</street><house_number xsi:type=\"xsd:int\">3</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754KK</postcode><city xsi:type=\"xsd:string\">Makkum Fr</city><street xsi:type=\"xsd:string\">It Med</street><house_number xsi:type=\"xsd:int\">3</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754KK</postcode><city xsi:type=\"xsd:string\">Makkum</city><street xsi:type=\"xsd:string\">It Mêd</street><house_number xsi:type=\"xsd:int\">3</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754KK</postcode><city xsi:type=\"xsd:string\">Makkum FR</city><street xsi:type=\"xsd:string\">It Med</street><house_number xsi:type=\"xsd:int\">3</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\"></telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\"></contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\"></contact_surname><contact_gender xsi:type=\"xsd:string\"></contact_gender><primary_sbi_code xsi:type=\"xsd:string\">90011</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\"></secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Beoefening van podiumkunst</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\"></secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">0</personnel><class_personnel xsi:type=\"xsd:int\">1</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">0</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">1</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2005</year><month xsi:type=\"xsd:int\">10</month><day xsi:type=\"xsd:int\">4</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_economically_active xsi:type=\"xsd:boolean\">false</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">1997</year><month xsi:type=\"xsd:int\">1</month><day xsi:type=\"xsd:int\">17</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[1]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">90011</sbi_code><description xsi:type=\"xsd:string\">Beoefening van podiumkunst</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[0]\"></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"><SOAP-ENV:Header><nu2293:HeaderAuthenticate xmlns:nu2293=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">65dd2b938a8d5956da6bfce8ef496e62</reactid></nu2293:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><SOAP-ENV:Fault><faultcode>Server</faultcode><faultstring>Vat number for business not found</faultstring><faultactor></faultactor><detail><soapVal xsi:type=\"xsd:string\"></soapVal><errorcode xsi:type=\"xsd:string\">Server.Data.NotFound</errorcode></detail></SOAP-ENV:Fault></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, false);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"Stichting Apollo Makkum\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"41005674\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"It Med\",\"to_BusinessPartnerAddress.HouseNumber\":\"3\",\"FormOfAddress\":\"0003\",\"SearchTerm1\":\"Stichting Apollo Mak\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Stichting Apollo Makkum\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(853455600000)/\",\"OrganizationBPName1\":\"Stichting Apollo Makkum\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"8754 KK\",\"to_BusinessPartnerAddress.CityName\":\"Makkum\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"S\",\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_legal_name_bus_bus\":\"Stichting Apollo Makkum\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"0\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"ZZ1_rsin_number_bus_bus\":\"806054232\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"S\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Stichting Apollo Makkum\",\"ZZ1_legal_name_bus_bus\":\"Stichting Apollo Makkum\",\"BusinessPartnerFullName\":\"Stichting Apollo Makkum\",\"ZZ1_rsin_number_bus_bus\":\"806054232\",\"BusinessPartnerName\":\"Stichting Apollo Makkum\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"0\",\"to_BuPaIdentification.BPIdentificationNumber\":\"41005674\",\"OrganizationFoundationDate\":\"/Date(853455600000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"SearchTerm1\":\"Stichting Apollo Mak\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Makkum\",\"HouseNumber\":\"3\",\"StreetName\":\"It Med\",\"Country\":\"NL\",\"PostalCode\":\"8754 KK\",\"Language\":\"NL\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_12() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu2367:HeaderAuthenticate xmlns:nu2367=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">f5accdc915c9873a72797d676df3ddd2</reactid></nu2367:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">53836030</dossier_number><establishment_number xsi:type=\"xsd:string\">000023685948</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">New</item></update_types><date_last_update xsi:type=\"xsd:date\">2011-11-10</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">53836030</dossier_number><establishment_number xsi:type=\"xsd:string\">000023685948</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000023685948</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><chamber_number xsi:type=\"xsd:string\">01</chamber_number><legal_form_code xsi:type=\"xsd:string\">1</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Eenmanszaak</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">O</indication_organisation_code><legal_name xsi:type=\"xsd:string\"></legal_name><trade_name_45 xsi:type=\"xsd:string\">Klussenbedrijf Kooistra Bouw Makkum</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Klussenbedrijf Kooistra Bouw Makkum</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[0]\"></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754GW</postcode><city xsi:type=\"xsd:string\">Makkum</city><street xsi:type=\"xsd:string\">De Polle</street><house_number xsi:type=\"xsd:int\">4</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754GW</postcode><city xsi:type=\"xsd:string\">Makkum</city><street xsi:type=\"xsd:string\">De Pôlle</street><house_number xsi:type=\"xsd:int\">4</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754GW</postcode><city xsi:type=\"xsd:string\">Makkum</city><street xsi:type=\"xsd:string\">De Polle</street><house_number xsi:type=\"xsd:int\">4</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754GW</postcode><city xsi:type=\"xsd:string\">Makkum Fr</city><street xsi:type=\"xsd:string\">De Polle</street><house_number xsi:type=\"xsd:int\">4</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754GW</postcode><city xsi:type=\"xsd:string\">Makkum</city><street xsi:type=\"xsd:string\">De Pôlle</street><house_number xsi:type=\"xsd:int\">4</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">8754GW</postcode><city xsi:type=\"xsd:string\">Makkum FR</city><street xsi:type=\"xsd:string\">De Polle</street><house_number xsi:type=\"xsd:int\">4</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\"></telephone_number><mobile_number xsi:type=\"xsd:string\">06 51251712</mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\">P.J.</contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\">Kooistra</contact_surname><contact_gender xsi:type=\"xsd:string\">m</contact_gender><primary_sbi_code xsi:type=\"xsd:string\">4120</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\"></secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Algemene burgerlijke en utiliteitsbouw</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\"></secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">1</personnel><class_personnel xsi:type=\"xsd:int\">2</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">1</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">2</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2011</year><month xsi:type=\"xsd:int\">10</month><day xsi:type=\"xsd:int\">27</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">true</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2011</year><month xsi:type=\"xsd:int\">11</month><day xsi:type=\"xsd:int\">1</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[1]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">4120</sbi_code><description xsi:type=\"xsd:string\">Algemene burgerlijke en utiliteitsbouw</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[2]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">4332</sbi_code><description xsi:type=\"xsd:string\">Bouwtimmeren</description></item><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">43993</sbi_code><description xsi:type=\"xsd:string\">Metselen en voegen</description></item></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"><SOAP-ENV:Header><nu6842:HeaderAuthenticate xmlns:nu6842=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">717a23e1bc53c34d3b63c16b0db2bb2b</reactid></nu6842:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><SOAP-ENV:Fault><faultcode>Server</faultcode><faultstring>Vat number for business not found</faultstring><faultactor></faultactor><detail><soapVal xsi:type=\"xsd:string\"></soapVal><errorcode xsi:type=\"xsd:string\">Server.Data.NotFound</errorcode></detail></SOAP-ENV:Fault></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, true);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"Klussenbedrijf Kooistra Bouw Makkum\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000023685948\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"De Polle\",\"to_BusinessPartnerAddress.HouseNumber\":\"4\",\"FormOfAddress\":\"0003\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Klussenbedrijf Kooistra Bouw Makkum\",\"ZZ1_Locationnumber_bus_bus\":\"000023685948\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(1320102000000)/\",\"OrganizationBPName1\":\"Klussenbedrijf Kooistra Bouw Makkum\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"8754 GW\",\"to_BusinessPartnerAddress.CityName\":\"Makkum\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"O\",\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"1\",\"ZZ1_pers_fulltime_bus_bus\":\"1\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"O\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Klussenbedrijf Kooistra Bouw Makkum\",\"BusinessPartnerFullName\":\"Klussenbedrijf Kooistra Bouw Makkum\",\"ZZ1_Locationnumber_bus_bus\":\"000023685948\",\"BusinessPartnerName\":\"Klussenbedrijf Kooistra Bouw Makkum\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"1\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000023685948\",\"OrganizationFoundationDate\":\"/Date(1320102000000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"1\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Makkum\",\"HouseNumber\":\"4\",\"StreetName\":\"De Polle\",\"Country\":\"NL\",\"PostalCode\":\"8754 GW\",\"Language\":\"NL\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"},{\"BusinessPartnerRole\":\"FLVN01\"},{\"BusinessPartnerRole\":\"FLVN00\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_13() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu7715:HeaderAuthenticate xmlns:nu7715=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">8bd25051dbb3b37196940aca46b39034</reactid></nu7715:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">41067856</dossier_number><establishment_number xsi:type=\"xsd:string\">000054864070</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Capital</item></update_types><date_last_update xsi:type=\"xsd:date\">2023-07-12</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">41067856</dossier_number><establishment_number xsi:type=\"xsd:string\">000054864070</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000021587205</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">false</indication_main_establishment><rsin_number xsi:type=\"xsd:string\">800301699</rsin_number><chamber_number xsi:type=\"xsd:string\">14</chamber_number><legal_form_code xsi:type=\"xsd:string\">74</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Stichting</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">S</indication_organisation_code><legal_name xsi:type=\"xsd:string\">Stichting Leef Kind</legal_name><trade_name_45 xsi:type=\"xsd:string\">Locatie Koningsbosch Leef Kind</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Locatie Koningsbosch Leef Kind</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Locatie Koningsbosch Leef Kind</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6104BR</postcode><city xsi:type=\"xsd:string\">KONINGSBOSCH</city><street xsi:type=\"xsd:string\">Karel V Straat</street><house_number xsi:type=\"xsd:int\">45</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6104BR</postcode><city xsi:type=\"xsd:string\">Koningsbosch</city><street xsi:type=\"xsd:string\">Karel V straat</street><house_number xsi:type=\"xsd:int\">45</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6104BR</postcode><city xsi:type=\"xsd:string\">Koningsbosch</city><street xsi:type=\"xsd:string\">Karel V Straat</street><house_number xsi:type=\"xsd:int\">45</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6071BP</postcode><city xsi:type=\"xsd:string\">SWALMEN</city><street xsi:type=\"xsd:string\">GeStringen</street><house_number xsi:type=\"xsd:int\">3</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6071BP</postcode><city xsi:type=\"xsd:string\">Swalmen</city><street xsi:type=\"xsd:string\">GeStringen</street><house_number xsi:type=\"xsd:int\">3</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6071BP</postcode><city xsi:type=\"xsd:string\">Swalmen</city><street xsi:type=\"xsd:string\">GeStringen</street><house_number xsi:type=\"xsd:int\">3</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\"></telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\">S.</contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\">Geurts</contact_surname><contact_gender xsi:type=\"xsd:string\"></contact_gender><primary_sbi_code xsi:type=\"xsd:string\">8891</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\"></secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Kinderopvang en peuterspeelzaalwerk</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\"></secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">0</personnel><class_personnel xsi:type=\"xsd:int\">1</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">0</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">1</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2023</year><month xsi:type=\"xsd:int\">1</month><day xsi:type=\"xsd:int\">26</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_import xsi:type=\"xsd:boolean\">false</indication_import><indication_export xsi:type=\"xsd:boolean\">false</indication_export><indication_economically_active xsi:type=\"xsd:boolean\">false</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">true</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><founding_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">1991</year><month xsi:type=\"xsd:int\">12</month><day xsi:type=\"xsd:int\">23</day></founding_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2023</year><month xsi:type=\"xsd:int\">1</month><day xsi:type=\"xsd:int\">1</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[1]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">8891</sbi_code><description xsi:type=\"xsd:string\">Kinderopvang en peuterspeelzaalwerk</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[0]\"></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu4289:HeaderAuthenticate xmlns:nu4289=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">5624fb156877233a973115ba3f97334f</reactid></nu4289:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetVatNumberResponse><out xsi:type=\"tns:DutchBusinessVatNumber\"><dossier_number xsi:type=\"xsd:string\">41067856</dossier_number><vat_number xsi:type=\"xsd:string\">NL800301699B01</vat_number><date_last_update xsi:type=\"xsd:date\">2015-07-07</date_last_update></out></dutchBusinessGetVatNumberResponse></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, true);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"Locatie Koningsbosch Leef Kind\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000054864070\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Karel V Straat\",\"to_BusinessPartnerAddress.HouseNumber\":\"45\",\"FormOfAddress\":\"0003\",\"SearchTerm1\":\"Stichting Leef Kind\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Locatie Koningsbosch Leef Kind\",\"ZZ1_Locationnumber_bus_bus\":\"000054864070\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(1672527600000)/\",\"OrganizationBPName1\":\"Locatie Koningsbosch Leef Kind\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"6104 BR\",\"to_BusinessPartnerAddress.CityName\":\"Koningsbosch\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":true,\"ZZ1_import_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"S\",\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_legal_name_bus_bus\":\"Stichting Leef Kind\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"0\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"ZZ1_rsin_number_bus_bus\":\"800301699\",\"to_BusinessPartnerTax.BPTaxNumber\":\"NL800301699B01\",\"SearchTerm2\":\"Locatie Koningsbosch\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"S\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Locatie Koningsbosch Leef Kind\",\"ZZ1_legal_name_bus_bus\":\"Stichting Leef Kind\",\"BusinessPartnerFullName\":\"Locatie Koningsbosch Leef Kind\",\"ZZ1_Locationnumber_bus_bus\":\"000054864070\",\"ZZ1_rsin_number_bus_bus\":\"800301699\",\"BusinessPartnerName\":\"Locatie Koningsbosch Leef Kind\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"0\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000054864070\",\"OrganizationFoundationDate\":\"/Date(1672527600000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"SearchTerm2\":\"Locatie Koningsbosch\",\"SearchTerm1\":\"Stichting Leef Kind\",\"ZZ1_non_mail_bus_bus\":true,\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_import_bus_bus\":false,\"ZZ1_export_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Koningsbosch\",\"HouseNumber\":\"45\",\"StreetName\":\"Karel V Straat\",\"Country\":\"NL\",\"PostalCode\":\"6104 BR\",\"Language\":\"NL\"}],\"to_BusinessPartnerTax\":[{\"BPTaxNumber\":\"NL800301699B01\",\"BPTaxType\":\"NL0\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"},{\"BusinessPartnerRole\":\"FLVN01\"},{\"BusinessPartnerRole\":\"FLVN00\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_14() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu6727:HeaderAuthenticate xmlns:nu6727=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">1d0de8e1159ea7da00fd8616c4cddd81</reactid></nu6727:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">12051529</dossier_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">EstablishmentAddress</item></update_types><date_last_update xsi:type=\"xsd:date\">2016-02-04</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">12051529</dossier_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><rsin_number xsi:type=\"xsd:string\">819255749</rsin_number><chamber_number xsi:type=\"xsd:string\">14</chamber_number><legal_form_code xsi:type=\"xsd:string\">71</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Vereniging met volledige rechtsbevoegdheid</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">V</indication_organisation_code><legal_name xsi:type=\"xsd:string\">Conventus Maria-Hoop-Koningsbosch &apos;03</legal_name><trade_name_45 xsi:type=\"xsd:string\">Conventus &apos;03</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Conventus &apos;03</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[0]\"></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6104BG</postcode><city xsi:type=\"xsd:string\">Koningsbosch</city><street xsi:type=\"xsd:string\">Prinsenbaan</street><house_number xsi:type=\"xsd:int\">24</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6104BG</postcode><city xsi:type=\"xsd:string\">Koningsbosch</city><street xsi:type=\"xsd:string\">Prinsenbaan</street><house_number xsi:type=\"xsd:int\">24</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6104BG</postcode><city xsi:type=\"xsd:string\">Koningsbosch</city><street xsi:type=\"xsd:string\">Prinsenbaan</street><house_number xsi:type=\"xsd:int\">24</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6105CN</postcode><city xsi:type=\"xsd:string\">Maria Hoop</city><street xsi:type=\"xsd:string\">Vlaskuilseweg</street><house_number xsi:type=\"xsd:int\">21</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6105CN</postcode><city xsi:type=\"xsd:string\">Maria Hoop</city><street xsi:type=\"xsd:string\">Vlaskuilseweg</street><house_number xsi:type=\"xsd:int\">21</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">6105CN</postcode><city xsi:type=\"xsd:string\">Maria Hoop</city><street xsi:type=\"xsd:string\">Vlaskuilseweg</street><house_number xsi:type=\"xsd:int\">21</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\"></telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\"></contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\"></contact_surname><contact_gender xsi:type=\"xsd:string\"></contact_gender><primary_sbi_code xsi:type=\"xsd:string\">93121</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\"></secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Veldvoetbal</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\"></secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">0</personnel><class_personnel xsi:type=\"xsd:int\">1</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">0</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">1</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2007</year><month xsi:type=\"xsd:int\">8</month><day xsi:type=\"xsd:int\">28</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_economically_active xsi:type=\"xsd:boolean\">false</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><founding_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2003</year><month xsi:type=\"xsd:int\">8</month><day xsi:type=\"xsd:int\">16</day></founding_date><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2003</year><month xsi:type=\"xsd:int\">8</month><day xsi:type=\"xsd:int\">16</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[1]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">93121</sbi_code><description xsi:type=\"xsd:string\">Veldvoetbal</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[0]\"></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu3672:HeaderAuthenticate xmlns:nu3672=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">6a6199089266a4ba81aef0df1c9695c8</reactid></nu3672:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetVatNumberResponse><out xsi:type=\"tns:DutchBusinessVatNumber\"><dossier_number xsi:type=\"xsd:string\">12051529</dossier_number><vat_number xsi:type=\"xsd:string\">NL819255749B01</vat_number><date_last_update xsi:type=\"xsd:date\">2015-05-16</date_last_update></out></dutchBusinessGetVatNumberResponse></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(false, true);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"Conventus '03\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"12051529\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Prinsenbaan\",\"to_BusinessPartnerAddress.HouseNumber\":\"24\",\"FormOfAddress\":\"0003\",\"SearchTerm1\":\"Conventus Maria-Hoop\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Conventus '03\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(1060984800000)/\",\"OrganizationBPName1\":\"Conventus '03\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"6104 BG\",\"to_BusinessPartnerAddress.CityName\":\"Koningsbosch\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"V\",\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_legal_name_bus_bus\":\"Conventus Maria-Hoop-Koningsbosch '03\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"0\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"ZZ1_rsin_number_bus_bus\":\"819255749\",\"to_BusinessPartnerTax.BPTaxNumber\":\"NL819255749B01\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"V\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Conventus '03\",\"ZZ1_legal_name_bus_bus\":\"Conventus Maria-Hoop-Koningsbosch '03\",\"BusinessPartnerFullName\":\"Conventus '03\",\"ZZ1_rsin_number_bus_bus\":\"819255749\",\"BusinessPartnerName\":\"Conventus '03\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"0\",\"to_BuPaIdentification.BPIdentificationNumber\":\"12051529\",\"OrganizationFoundationDate\":\"/Date(1060984800000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"0\",\"SearchTerm1\":\"Conventus Maria-Hoop\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"Koningsbosch\",\"HouseNumber\":\"24\",\"StreetName\":\"Prinsenbaan\",\"Country\":\"NL\",\"PostalCode\":\"6104 BG\",\"Language\":\"NL\"}],\"to_BusinessPartnerTax\":[{\"BPTaxNumber\":\"NL819255749B01\",\"BPTaxType\":\"NL0\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLVN01\"},{\"BusinessPartnerRole\":\"FLVN00\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

        @Test
        void test_15() {
            String businessInfo =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:tns=\"http://www.webservices.nl/soap/\"><SOAP-ENV:Header><nu9778:HeaderAuthenticate xmlns:nu9778=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">7adaada78e094233ba71765953a01e6b</reactid></nu9778:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><dutchBusinessGetDossierV3Response><out xsi:type=\"tns:DutchBusinessDossierV3\"><update_info xsi:type=\"tns:DutchBusinessUpdateReference\"><dossier_number xsi:type=\"xsd:string\">09138739</dossier_number><establishment_number xsi:type=\"xsd:string\">000000949582</establishment_number><update_types xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Tradenames</item></update_types><date_last_update xsi:type=\"xsd:date\">2022-06-10</date_last_update></update_info><dossier_number xsi:type=\"xsd:string\">09138739</dossier_number><establishment_number xsi:type=\"xsd:string\">000000949582</establishment_number><main_establishment_number xsi:type=\"xsd:string\">000000949582</main_establishment_number><indication_main_establishment xsi:type=\"xsd:boolean\">true</indication_main_establishment><chamber_number xsi:type=\"xsd:string\">09</chamber_number><legal_form_code xsi:type=\"xsd:string\">1</legal_form_code><legal_form_text xsi:type=\"xsd:string\">Eenmanszaak</legal_form_text><indication_organisation_code xsi:type=\"xsd:string\">O</indication_organisation_code><legal_name xsi:type=\"xsd:string\"></legal_name><trade_name_45 xsi:type=\"xsd:string\">Bogaard Business Solutions</trade_name_45><trade_name_full xsi:type=\"xsd:string\">Bogaard Business Solutions</trade_name_full><trade_names xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"xsd:string[1]\"><item xsi:type=\"xsd:string\">Bogaard Business Solutions</item></trade_names><establishment_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7041SR</postcode><city xsi:type=\"xsd:string\">&apos;s-Heerenberg</city><street xsi:type=\"xsd:string\">Witte Paters</street><house_number xsi:type=\"xsd:int\">13</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7041SR</postcode><city xsi:type=\"xsd:string\">&apos;s-Heerenberg</city><street xsi:type=\"xsd:string\">Witte Paters</street><house_number xsi:type=\"xsd:int\">13</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7041SR</postcode><city xsi:type=\"xsd:string\">&apos;s-Heerenberg</city><street xsi:type=\"xsd:string\">Witte Paters</street><house_number xsi:type=\"xsd:int\">13</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></establishment_address><correspondence_address xsi:type=\"tns:DutchBusinessFormattedAddress\"><original xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7000AG</postcode><city xsi:type=\"xsd:string\">Doetinchem</city><street xsi:type=\"xsd:string\">Postbus</street><house_number xsi:type=\"xsd:int\">269</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></original><official xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7000AG</postcode><city xsi:type=\"xsd:string\">Doetinchem</city><street xsi:type=\"xsd:string\">Postbus</street><house_number xsi:type=\"xsd:int\">269</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">Nederland</country></official><formatted xsi:type=\"tns:DutchBusinessAddressV3\"><postcode xsi:type=\"xsd:string\">7000AG</postcode><city xsi:type=\"xsd:string\">Doetinchem</city><street xsi:type=\"xsd:string\">Postbus</street><house_number xsi:type=\"xsd:int\">269</house_number><house_number_addition xsi:type=\"xsd:string\"></house_number_addition><country xsi:type=\"xsd:string\">NLD</country></formatted></correspondence_address><telephone_number xsi:type=\"xsd:string\">0314 665255</telephone_number><mobile_number xsi:type=\"xsd:string\"></mobile_number><domain_name xsi:type=\"xsd:string\"></domain_name><contact_title1 xsi:type=\"xsd:string\"></contact_title1><contact_title2 xsi:type=\"xsd:string\"></contact_title2><contact_initials xsi:type=\"xsd:string\">W.</contact_initials><contact_prefix xsi:type=\"xsd:string\"></contact_prefix><contact_surname xsi:type=\"xsd:string\">Bogaard</contact_surname><contact_gender xsi:type=\"xsd:string\">m</contact_gender><primary_sbi_code xsi:type=\"xsd:string\">69203</primary_sbi_code><secondary_sbi_code1 xsi:type=\"xsd:string\"></secondary_sbi_code1><secondary_sbi_code2 xsi:type=\"xsd:string\"></secondary_sbi_code2><primary_sbi_code_text xsi:type=\"xsd:string\">Boekhoudkantoren</primary_sbi_code_text><secondary_sbi_code1_text xsi:type=\"xsd:string\"></secondary_sbi_code1_text><secondary_sbi_code2_text xsi:type=\"xsd:string\"></secondary_sbi_code2_text><personnel xsi:type=\"xsd:int\">3</personnel><class_personnel xsi:type=\"xsd:int\">3</class_personnel><personnel_fulltime xsi:type=\"xsd:int\">3</personnel_fulltime><class_personnel_fulltime xsi:type=\"xsd:int\">3</class_personnel_fulltime><personnel_reference_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2009</year><month xsi:type=\"xsd:int\">4</month><day xsi:type=\"xsd:int\">14</day></personnel_reference_date><personnel_ci xsi:type=\"xsd:int\">0</personnel_ci><class_personnel_ci xsi:type=\"xsd:int\">0</class_personnel_ci><indication_economically_active xsi:type=\"xsd:boolean\">true</indication_economically_active><indication_non_mailing xsi:type=\"xsd:boolean\">false</indication_non_mailing><indication_bankruptcy xsi:type=\"xsd:boolean\">false</indication_bankruptcy><indication_dip xsi:type=\"xsd:boolean\">false</indication_dip><authorized_share_capital xsi:type=\"xsd:long\">0</authorized_share_capital><authorized_share_capital_currency xsi:type=\"xsd:string\">EUR</authorized_share_capital_currency><paid_up_share_capital xsi:type=\"xsd:long\">0</paid_up_share_capital><paid_up_share_capital_currency xsi:type=\"xsd:string\">EUR</paid_up_share_capital_currency><issued_share_capital xsi:type=\"xsd:long\">0</issued_share_capital><issued_share_capital_currency xsi:type=\"xsd:string\">EUR</issued_share_capital_currency><establishment_date xsi:type=\"tns:DutchBusinessDateV3\"><year xsi:type=\"xsd:int\">2003</year><month xsi:type=\"xsd:int\">11</month><day xsi:type=\"xsd:int\">10</day></establishment_date><sbi_collection xsi:type=\"tns:DutchBusinessSBICollection\"><original xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[1]\"><item xsi:type=\"tns:DutchBusinessSBICode\"><sbi_code xsi:type=\"xsd:string\">69203</sbi_code><description xsi:type=\"xsd:string\">Boekhoudkantoren</description></item></original><company_info xsi:type=\"SOAP-ENC:Array\" SOAP-ENC:arrayType=\"tns:DutchBusinessSBICode[0]\"></company_info></sbi_collection></out></dutchBusinessGetDossierV3Response></SOAP-ENV:Body></SOAP-ENV:Envelope>";
            String vatXml =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope SOAP-ENV:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:SOAP-ENC=\"http://schemas.xmlsoap.org/soap/encoding/\"><SOAP-ENV:Header><nu4097:HeaderAuthenticate xmlns:nu4097=\"http://www.webservices.nl/soap/\"><reactid xsi:type=\"xsd:string\">ffaff5a96e9cf8257cd1668c2e7e7366</reactid></nu4097:HeaderAuthenticate></SOAP-ENV:Header><SOAP-ENV:Body><SOAP-ENV:Fault><faultcode>Server</faultcode><faultstring>Vat number for business not found</faultstring><faultactor></faultactor><detail><soapVal xsi:type=\"xsd:string\"></soapVal><errorcode xsi:type=\"xsd:string\">Server.Data.NotFound</errorcode></detail></SOAP-ENV:Fault></SOAP-ENV:Body></SOAP-ENV:Envelope>";

            CustomerTypeSelected customerTypeSelected = new CustomerTypeSelected(true, false);
            InputSource is = new InputSource(new ByteArrayInputStream(businessInfo.getBytes(StandardCharsets.UTF_8)));
            when(businessPartnerRoleMapper.add(customerTypeSelected)).thenReturn(
                createJsonArrayWithCustomerType(customerTypeSelected));
            when(s4HMappingRepository.getS4HMapping()).thenReturn(createMappingListForS4H());

            //Intermediate check
            JsonObject intermediateJsonResult = jsonUtilsS4H.getS4HJSONMapping(is, vatXml);
            String mapping =
                "{\"BusinessPartnerFullName\":\"Bogaard Business Solutions\",\"LegalForm\":\"01\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000000949582\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"to_BusinessPartnerAddress.StreetName\":\"Witte Paters\",\"to_BusinessPartnerAddress.HouseNumber\":\"13\",\"to_BusinessPartnerAddress.to_PhoneNumber.PhoneNumber\":\"0314 665255\",\"FormOfAddress\":\"0003\",\"to_BusinessPartnerAddress.Country\":\"NL\",\"BusinessPartnerName\":\"Bogaard Business Solutions\",\"ZZ1_Locationnumber_bus_bus\":\"000000949582\",\"to_BusinessPartnerTax.BPTaxType\":\"NL0\",\"OrganizationFoundationDate\":\"/Date(1068418800000)/\",\"OrganizationBPName1\":\"Bogaard Business Solutions\",\"BusinessPartnerCategory\":\"2\",\"to_BusinessPartnerAddress.PostalCode\":\"7041 SR\",\"to_BusinessPartnerAddress.CityName\":\"'s-Heerenberg\",\"BusinessPartnerGrouping\":\"BP02\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_org_code_bus_bus\":\"O\",\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_bankruptcy_bus_bus\":false,\"ZZ1_dip_bus_bus\":false,\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"ZZ1_personnel_bus_bus\":\"3\",\"ZZ1_pers_fulltime_bus_bus\":\"3\",\"SearchTerm2\":\"Bogaard Business Sol\",\"to_BusinessPartnerAddress.Language\":\"NL\"}";
            compareContentEquals(mapping, intermediateJsonResult.toString());

            JsonObject finalJson = jsonUtilsS4H.parseJSONForCreate(intermediateJsonResult, customerTypeSelected);
            String parsedMapping =
                "{\"ZZ1_org_code_bus_bus\":\"O\",\"FormOfAddress\":\"0003\",\"BusinessPartnerCategory\":\"2\",\"ZZ1_paid_up_capi_bus_bus\":\".00\",\"OrganizationBPName1\":\"Bogaard Business Solutions\",\"BusinessPartnerFullName\":\"Bogaard Business Solutions\",\"ZZ1_Locationnumber_bus_bus\":\"000000949582\",\"BusinessPartnerName\":\"Bogaard Business Solutions\",\"LegalForm\":\"01\",\"BusinessPartnerGrouping\":\"BP02\",\"to_BuPaIdentification.BPIdentificationType\":\"BUP002\",\"ZZ1_personnel_bus_bus\":\"3\",\"to_BuPaIdentification.BPIdentificationNumber\":\"000000949582\",\"OrganizationFoundationDate\":\"/Date(1068418800000)/\",\"ZZ1_share_cap_bus_bus\":\".00\",\"ZZ1_auth_sharecap_bus_bus\":\".00\",\"ZZ1_pers_fulltime_bus_bus\":\"3\",\"SearchTerm2\":\"Bogaard Business Sol\",\"ZZ1_non_mail_bus_bus\":false,\"ZZ1_econ_active_bus_bus\":true,\"ZZ1_dip_bus_bus\":false,\"ZZ1_bankruptcy_bus_bus\":false,\"to_BusinessPartnerAddress\":[{\"CityName\":\"'s-Heerenberg\",\"HouseNumber\":\"13\",\"StreetName\":\"Witte Paters\",\"Country\":\"NL\",\"PostalCode\":\"7041 SR\",\"Language\":\"NL\"}],\"to_BusinessPartnerRole\":[{\"BusinessPartnerRole\":\"FLCU00\"},{\"BusinessPartnerRole\":\"FLCU01\"}],\"to_BuPaIdentification\":[]}";
            compareContentEquals(parsedMapping, finalJson.toString());
        }

    }

}
